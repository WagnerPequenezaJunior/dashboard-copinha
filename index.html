<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Copinha Masculina 2026 - Dashboard</title>

<!-- Chart.js - DEVE VIR PRIMEIRO -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Chart.js Treemap Plugin - DEPOIS do Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2.3.0"></script>

<!-- html2canvas + jsPDF para exportar PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --purple:#9b1cdb;
  --purple-dark:#7a16af;
  --purple-light:#b845e8;
  --accent:#f8e847;
  --bg:#f6f5fb;
  --card-radius:16px;
  --max-width:1400px;
}

/* Reset / base */
*{box-sizing:border-box;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif}
body{margin:0;background:var(--bg);padding:22px;display:flex;justify-content:center}
.container{width:100%;max-width:var(--max-width);}

/* ============================================
   PROGRESS BAR - LOADING NO TOPO
============================================ */
#progressBar{
  position:fixed;
  top:0;
  left:0;
  width:0%;
  height:4px;
  background:linear-gradient(90deg, var(--purple) 0%, var(--accent) 100%);
  z-index:9999;
  transition:width 0.3s ease;
  box-shadow:0 2px 8px rgba(155,28,219,0.4);
}

/* ============================================
   SKELETON LOADING - ANIMA√á√ÉO
============================================ */
.skeleton{
  background:linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size:200% 100%;
  animation:loading 1.5s infinite;
  border-radius:8px;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeleton-card{
  background:linear-gradient(135deg, #fff 0%, #f8f5ff 100%);
  border-radius:16px;
  padding:20px;
  border:2px solid rgba(155,28,219,0.1);
  height:130px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.skeleton-title{
  width:60%;
  height:14px;
  margin-bottom:12px;
}

.skeleton-value{
  width:80%;
  height:36px;
}

.skeleton-chart{
  background:linear-gradient(135deg, #faf8ff 0%, #fff 100%);
  border-radius:14px;
  padding:18px;
  border:2px solid rgba(155,28,219,0.1);
  height:350px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.skeleton-chart-title{
  width:40%;
  height:18px;
}

.skeleton-chart-body{
  flex:1;
  width:100%;
}

/* HEADER */
.header{
  background:linear-gradient(135deg,var(--purple),var(--purple-dark));
  color:#fff;padding:18px;border-radius:var(--card-radius);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  flex-wrap:wrap;
}
.header-left{display:flex;align-items:center;gap:14px}
.logo{width:72px;height:72px;border-radius:50%;background:var(--accent);
  display:flex;align-items:center;justify-content:center;color:var(--purple-dark);
  font-weight:900;font-size:34px;box-shadow:0 8px 20px rgba(0,0,0,0.12)}
.title{font-size:28px;font-weight:900;color:#fff}
.header-sub{font-size:13px;opacity:0.95}
.header-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.refresh-btn{
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:8px;
  font-weight:800;
  font-size:12px;
  cursor:pointer;
  transition:all 0.3s ease;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.refresh-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(155,28,219,0.4);
}
.refresh-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}
.export-btn{
  background:linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:8px;
  font-weight:800;
  font-size:12px;
  cursor:pointer;
  transition:all 0.3s ease;
  text-transform:uppercase;
  letter-spacing:0.5px;
  box-shadow:0 2px 8px rgba(255,107,107,0.3);
}
.export-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(255,107,107,0.5);
}
.export-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}
.load-info{background:rgba(255,255,255,0.08);padding:6px 12px;border-radius:8px;font-size:12px;color:#fff;opacity:0.9}
.load-info.loading{
  animation:pulse 1.5s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 0.9; }
  50% { opacity: 0.5; }
}

/* CARDS */
.cards-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.card{
  background:linear-gradient(135deg, #fff 0%, #f8f5ff 100%);
  border-radius:16px;
  padding:20px;
  border:2px solid rgba(155,28,219,0.1);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  height:130px;
  position:relative;
  overflow:hidden;
  transition:all 0.3s ease;
  box-shadow:0 2px 8px rgba(155,28,219,0.08);
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(155,28,219,0.15);
  border-color:rgba(155,28,219,0.3);
}
.card::before{
  content:'';
  position:absolute;
  top:0;
  right:0;
  width:80px;
  height:80px;
  background:radial-gradient(circle, rgba(255,209,0,0.15) 0%, transparent 70%);
  border-radius:50%;
  transform:translate(30%, -30%);
}
.card .label{
  font-weight:800;
  color:var(--purple);
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  display:flex;
  align-items:center;
  gap:6px;
}
.card .value{
  font-size:36px;
  font-weight:900;
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-top:8px;
}
.card.reservas{
  background:linear-gradient(135deg, #fff8e1 0%, #ffe082 100%);
  border-color:rgba(255,193,7,0.4);
}
.card.reservas .label{color:#f57c00;}
.card.reservas .value{
  background:linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

/* CARDS HOJE */
.cards-row-today{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:14px}
.card-today-flex{
  background:linear-gradient(135deg, var(--accent) 0%, #ffed4e 100%);
  border-radius:16px;
  padding:24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  height:140px;
  color:var(--purple-dark);
  font-weight:800;
  position:relative;
  overflow:hidden;
  box-shadow:0 4px 16px rgba(255,209,0,0.25);
  transition:all 0.3s ease;
}
.card-today-flex:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(255,209,0,0.35);
}
.card-today-flex::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:4px;
  background:linear-gradient(90deg, var(--purple) 0%, var(--purple-light) 100%);
}
.card-today-flex .left{display:flex;flex-direction:column;align-items:flex-start;gap:8px;}
.card-today-flex .label{
  font-size:16px;
  font-weight:900;
  color:var(--purple);
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.card-today-flex .sub{
  font-size:13px;
  font-weight:700;
  padding:4px 12px;
  border-radius:20px;
  background:rgba(155,28,219,0.1);
  color:var(--purple);
}
.card-today-flex .sub.positive{background:#e8f5e9;color:#2e7d32;}
.card-today-flex .sub.negative{background:#ffebee;color:#c62828;}
.card-today-flex .right .value{
  font-size:42px;
  font-weight:900;
  color:var(--purple);
  text-shadow:2px 2px 4px rgba(0,0,0,0.1);
}

/* DISTRIBUI√á√ÉO */
.top-grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
.left-col{display:flex;flex-direction:column;gap:12px}
.distribuicao-container{margin-top:20px}
.toggle-btn{
  padding:10px 18px;
  font-weight:800;
  border-radius:10px;
  border:2px solid var(--purple);
  background:white;
  cursor:pointer;
  transition:all 0.3s ease;
  color:var(--purple);
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.toggle-btn:hover{
  background:rgba(155,28,219,0.05);
  transform:translateY(-2px);
}
.toggle-btn.active{
  background:var(--purple);
  color:white;
  box-shadow:0 4px 12px rgba(155,28,219,0.3);
}

/* BOT√ÉO FILTRO TOGGLE (Top 5) */
.toggle-filter-btn{
  padding:8px 14px;
  font-weight:700;
  border-radius:8px;
  border:2px solid rgba(155,28,219,0.3);
  background:white;
  cursor:pointer;
  transition:all 0.3s ease;
  color:#64748b;
  font-size:12px;
  letter-spacing:0.3px;
  white-space:nowrap;
}
.toggle-filter-btn:hover{
  background:rgba(155,28,219,0.05);
  border-color:rgba(155,28,219,0.5);
  transform:translateY(-2px);
}
.toggle-filter-btn.active{
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:white;
  border-color:var(--purple);
  box-shadow:0 4px 12px rgba(155,28,219,0.3);
}
.distribuicao-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:14px}
.card-dist{
  background:linear-gradient(135deg, var(--accent) 0%, #ffed4e 100%);
  border-radius:14px;
  padding:20px;
  color:var(--purple);
  font-weight:800;
  position:relative;
  overflow:hidden;
  transition:all 0.3s ease;
  box-shadow:0 2px 8px rgba(255,209,0,0.15);
}
.card-dist:hover{
  transform:translateY(-4px);
  box-shadow:0 6px 20px rgba(255,209,0,0.3);
}
.card-dist::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:3px;
  background:linear-gradient(90deg, var(--purple) 0%, var(--purple-light) 100%);
}
.card-dist > div:first-child{
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  margin-bottom:8px;
  opacity:0.9;
}
.card-dist .value{
  font-size:32px;
  font-weight:900;
  color:var(--purple-dark);
  text-shadow:1px 1px 2px rgba(0,0,0,0.1);
}
.card-dist .subpct{
  font-size:12px;
  opacity:0.8;
  margin-top:6px;
  font-weight:700;
}
.ocupacao-line{
  margin-top:14px;
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  padding:16px 20px;
  border-radius:12px;
  font-weight:900;
  color:white;
  font-size:18px;
  box-shadow:0 4px 16px rgba(155,28,219,0.25);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.ocupacao-line span{
  font-size:24px;
  text-shadow:2px 2px 4px rgba(0,0,0,0.2);
}

/* CHARTS - UM POR LINHA */
.row-charts{display:grid;grid-template-columns:1fr;gap:14px;margin-top:18px}
.chart-card{
  background:linear-gradient(135deg, #faf8ff 0%, #fff 100%);
  padding:18px;
  border-radius:14px;
  border:2px solid rgba(155,28,219,0.1);
  position:relative;
  overflow:hidden;
  transition:all 0.3s ease;
  box-shadow:0 2px 12px rgba(155,28,219,0.08);
}
.chart-card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(155,28,219,0.15);
  border-color:rgba(155,28,219,0.3);
}
.chart-card::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:4px;
  background:linear-gradient(90deg, var(--purple) 0%, var(--purple-light) 100%);
}

/* DONUTS */
#usuariosArea{margin-top:22px}
.donut-card{
  background:linear-gradient(135deg, #fff 0%, #f8f5ff 100%);
  border-radius:14px;
  padding:20px;
  border:2px solid rgba(155,28,219,0.1);
  transition:all 0.3s ease;
}
.donut-card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(155,28,219,0.15);
  border-color:rgba(155,28,219,0.3);
}
.donut-title{
  font-weight:900;
  color:var(--purple);
  font-size:14px;
  text-align:center;
  margin-bottom:16px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.donut-container{
  position:relative;
  height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:16px;
}
.donut-legend{
  display:flex;
  flex-direction:column;
  gap:8px;
  font-size:12px;
}
.legend-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:6px 10px;
  background:rgba(155,28,219,0.04);
  border-radius:6px;
  font-weight:700;
}
.legend-color{
  width:12px;
  height:12px;
  border-radius:3px;
  margin-right:8px;
  display:inline-block;
}
.legend-label{
  flex:1;
  color:var(--purple-dark);
  font-size:11px;
}
.legend-value{
  color:var(--purple);
  font-weight:900;
}

/* TABELA */
.table-wrap{
  margin-top:22px;
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  border-radius:16px;
  padding:20px;
  box-shadow:0 4px 20px rgba(155,28,219,0.2);
}
.table-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
  gap:12px;
}
.table-title{
  color:#fff;
  font-size:20px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:1px;
}
.rodada-filters{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.rodada-btn{
  padding:8px 16px;
  font-weight:800;
  border-radius:8px;
  border:2px solid rgba(255,255,255,0.3);
  background:rgba(255,255,255,0.1);
  cursor:pointer;
  transition:all 0.3s ease;
  color:#fff;
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.rodada-btn:hover{
  background:rgba(255,255,255,0.2);
  transform:translateY(-2px);
}
.rodada-btn.active{
  background:#fff;
  color:var(--purple);
  border-color:#fff;
  box-shadow:0 4px 12px rgba(255,255,255,0.3);
}
.table-container{
  background:#fff;
  border-radius:12px;
  overflow-x:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:1200px;
}
thead{
  background:var(--accent);
}
th{
  color:var(--purple-dark);
  padding:14px 10px;
  font-weight:900;
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  text-align:center;
  border-bottom:3px solid var(--purple);
  white-space:nowrap;
}
th:first-child{text-align:left;padding-left:16px;}
tbody tr{
  transition:all 0.2s ease;
  border-bottom:1px solid #f0f0f0;
}
tbody tr:hover{
  background:rgba(155,28,219,0.04);
}
tbody tr:last-child{
  border-bottom:none;
}
/* ORDENA√á√ÉO DA TABELA */
th.sortable{
  cursor:pointer;
  user-select:none;
  position:relative;
  transition:background 0.2s ease;
}
th.sortable:hover{
  background:rgba(155,28,219,0.08);
}
th.sortable::after{
  content:'‚áÖ';
  position:absolute;
  right:8px;
  opacity:0.3;
  font-size:12px;
}
th.sortable.asc::after{
  content:'‚Üë';
  opacity:1;
  color:var(--purple);
}
th.sortable.desc::after{
  content:'‚Üì';
  opacity:1;
  color:var(--purple);
}
td{
  padding:12px 10px;
  font-size:12px;
  color:#333;
  vertical-align:middle;
  text-align:center;
}
td:first-child{text-align:left;padding-left:16px;}
.games{
  line-height:18px;
  max-width:420px;
  text-align:left;
}
.game-item{
  display:flex;
  align-items:center;
  gap:6px;
  margin:3px 0;
  font-weight:600;
  font-size:11px;
  color:#555;
}
.codigo-cell{
  color:var(--purple);
  font-weight:900;
  font-size:14px;
  text-align:left;
}
.sede-cell{
  font-weight:700;
  color:var(--purple-dark);
  font-size:12px;
  text-align:left;
}
.sede-cell span{
  display:inline-block;
  vertical-align:middle;
  margin-right:4px;
}
.grupo-cell{
  font-size:11px;
  color:#666;
  font-weight:600;
  text-align:left;
  max-width:180px;
}
.data-cell{
  font-weight:600;
  color:#333;
  font-size:11px;
  white-space:normal;
  line-height:16px;
  min-width:85px;
  max-width:95px;
}
.data-cell .date{
  font-weight:700;
  color:var(--purple-dark);
  display:block;
  font-size:11px;
}
.data-cell .time{
  font-weight:600;
  color:#666;
  display:block;
  font-size:10px;
  margin-top:2px;
}
.status-badge{
  display:inline-block;
  padding:5px 14px;
  border-radius:14px;
  font-size:10px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:0.5px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.status-encerrado{
  background:linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  color:#fff;
}
.status-aberto{
  background:linear-gradient(135deg, #ff9800 0%, #ffa726 100%);
  color:#fff;
}
.number-cell{
  font-weight:800;
  text-align:center;
  font-size:13px;
}
.number-green{
  color:#2e7d32;
  background:rgba(76,175,80,0.08);
  padding:4px 8px;
  border-radius:6px;
}
.number-purple{
  color:var(--purple);
  background:rgba(155,28,219,0.08);
  padding:4px 8px;
  border-radius:6px;
}
.number-blue{
  color:#1976d2;
  background:rgba(25,118,210,0.08);
  padding:4px 8px;
  border-radius:6px;
}
.number-orange{
  color:#f57c00;
  background:rgba(245,124,0,0.08);
  padding:4px 8px;
  border-radius:6px;
}
.ocupacao-cell{
  font-weight:900;
  color:var(--purple);
  text-align:center;
  font-size:13px;
  background:rgba(155,28,219,0.06);
  padding:6px;
  border-radius:8px;
}

/* JOGOS MAIS BUSCADOS - √öLTIMA HORA */
.hot-games-container{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  margin-top:20px;
  margin-bottom:20px;
}
.hot-game-card{
  background:linear-gradient(135deg, #fff 0%, #faf8ff 100%);
  border:2px solid rgba(155,28,219,0.2);
  border-radius:14px;
  padding:16px;
  position:relative;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(155,28,219,0.12);
  transition:all 0.3s ease;
}
.hot-game-card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 20px rgba(155,28,219,0.25);
  border-color:rgba(155,28,219,0.4);
}
.hot-game-card::before{
  content:'üî•';
  position:absolute;
  top:8px;
  right:8px;
  font-size:28px;
  opacity:0.15;
  animation:pulse-fire 2s ease-in-out infinite;
}
@keyframes pulse-fire {
  0%, 100% { transform:scale(1); opacity:0.15; }
  50% { transform:scale(1.1); opacity:0.25; }
}
.hot-game-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:10px;
  padding-bottom:8px;
  border-bottom:2px solid rgba(155,28,219,0.15);
}
.hot-game-codigo{
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:white;
  font-weight:900;
  font-size:13px;
  padding:5px 12px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(155,28,219,0.3);
}
.hot-game-badge{
  background:linear-gradient(135deg, var(--accent) 0%, #ffed4e 100%);
  color:var(--purple-dark);
  font-weight:900;
  font-size:11px;
  padding:4px 10px;
  border-radius:6px;
  letter-spacing:0.5px;
  box-shadow:0 2px 6px rgba(248,232,71,0.3);
}
.hot-game-info{
  font-size:11px;
  color:#333;
  margin-bottom:8px;
  line-height:16px;
}
.hot-game-info strong{
  color:var(--purple-dark);
  font-weight:700;
}
.hot-game-stats{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:6px;
  margin-top:10px;
}
.hot-stat{
  background:rgba(155,28,219,0.03);
  border:1px solid rgba(155,28,219,0.1);
  padding:6px;
  border-radius:6px;
  text-align:center;
  font-size:10px;
}
.hot-stat-label{
  color:#666;
  font-weight:600;
  display:block;
  margin-bottom:2px;
}
.hot-stat-value{
  color:var(--purple);
  font-weight:900;
  font-size:13px;
}

/* SEDES - CARDS COM BARRAS */
.sede-card{
  background:linear-gradient(135deg, #fff 0%, #faf9fc 100%);
  border-radius:12px;
  padding:16px;
  border:2px solid rgba(155,28,219,0.1);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.sede-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 0;
  border-bottom:1px solid rgba(155,28,219,0.08);
}
.sede-item:last-child{
  border-bottom:none;
}
.sede-nome{
  font-size:11px;
  font-weight:700;
  color:#334155;
  min-width:100px;
  flex-shrink:0;
}
.sede-bar-container{
  flex:1;
  display:flex;
  align-items:center;
  gap:8px;
}
.sede-bar-bg{
  flex:1;
  height:20px;
  background:#f1f5f9;
  border-radius:10px;
  overflow:hidden;
  position:relative;
}
.sede-bar-fill{
  height:100%;
  background:linear-gradient(90deg, #9b1cdb 0%, #b845e8 100%);
  border-radius:10px;
  transition:width 0.6s ease;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding-right:6px;
}
.sede-valor{
  font-size:11px;
  font-weight:900;
  color:#9b1cdb;
  min-width:35px;
  text-align:right;
}

/* DISTRIBUI√á√ÉO GEOGR√ÅFICA */
.geo-cards-container{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  margin-top:18px;
}
.geo-card{
  background:linear-gradient(135deg, #fff 0%, #f8f5ff 100%);
  border-radius:14px;
  padding:18px;
  border:2px solid rgba(155,28,219,0.12);
  box-shadow:0 2px 8px rgba(155,28,219,0.08);
  transition:all 0.3s ease;
}
.geo-card:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 20px rgba(155,28,219,0.15);
  border-color:rgba(155,28,219,0.3);
}
.geo-card-title{
  font-weight:900;
  color:var(--purple-dark);
  font-size:14px;
  margin-bottom:14px;
  display:flex;
  align-items:center;
  gap:6px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.geo-resumo{
  text-align:center;
  padding:10px 0;
}
.geo-resumo-number{
  font-size:42px;
  font-weight:900;
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  line-height:1;
  margin-bottom:4px;
}
.geo-resumo-label{
  font-size:11px;
  font-weight:800;
  color:var(--purple);
  text-transform:uppercase;
  letter-spacing:0.8px;
  margin-bottom:16px;
}
.geo-resumo-text{
  font-size:11px;
  color:#64748b;
  line-height:16px;
  font-weight:600;
  margin-top:8px;
}
.geo-list{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.geo-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 10px;
  background:rgba(155,28,219,0.03);
  border-radius:8px;
  border:1px solid rgba(155,28,219,0.08);
  transition:all 0.2s ease;
}
.geo-item:hover{
  background:rgba(155,28,219,0.08);
  border-color:rgba(155,28,219,0.15);
}
.geo-item-pos{
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:white;
  font-weight:900;
  font-size:10px;
  width:22px;
  height:22px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}
.geo-item-name{
  flex:1;
  font-size:11px;
  font-weight:700;
  color:#334155;
  margin-left:10px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.geo-item-percent{
  font-size:12px;
  font-weight:900;
  color:var(--purple);
  flex-shrink:0;
}

/* FOOTER */
.footer-note{margin-top:14px;color:#666;font-size:13px;text-align:center}

/* ============================================
   ESTILOS DOS SETORES - IGUAL AO MOCKUP APROVADO
============================================ */
.setores-rodada-card{
  background:linear-gradient(135deg, #fff 0%, #f8f5ff 100%);
  border-radius:16px;
  padding:24px;
  margin-bottom:24px;
  border:2px solid rgba(155,28,219,0.15);
  box-shadow:0 4px 12px rgba(155,28,219,0.08);
}

.setores-rodada-header{
  margin-bottom:20px;
  padding-bottom:18px;
  border-bottom:2px solid rgba(155,28,219,0.1);
}

.setores-rodada-title-container{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:20px;
  margin-bottom:12px;
}

.setores-rodada-title{
  font-size:20px;
  font-weight:700;
  color:var(--purple);
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:white;
  padding:8px 16px;
  border-radius:8px;
  box-shadow:0 3px 10px rgba(155,28,219,0.3);
  white-space:nowrap;
}

.setores-jogos-info{
  display:flex;
  flex-direction:column;
  gap:6px;
  flex:1;
}

.setores-jogo-linha{
  font-size:15px;
  color:#333;
  font-weight:600;
}

.setores-meta-info{
  display:flex;
  gap:18px;
  flex-wrap:wrap;
  font-size:14px;
  color:#666;
  margin-top:8px;
}

.setores-meta-item{
  display:flex;
  align-items:center;
  gap:6px;
}

.setores-table-container{
  overflow-x:auto;
  margin-top:18px;
}

.setores-table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
}

.setores-table thead{
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:#fff !important;
}

.setores-table th{
  padding:16px 12px;
  text-align:left;
  font-weight:600;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  white-space:nowrap;
  color:#fff !important;
}

.setores-table th.sortable{
  cursor:pointer;
  user-select:none;
  position:relative;
}

.setores-table th.sortable:hover{
  background:rgba(255,255,255,0.1);
}

.setores-table th.sortable::after{
  content:'‚áÖ';
  margin-left:5px;
  opacity:0.5;
  font-size:11px;
}

.setores-table th.sortable.asc::after{
  content:'‚ñ≤';
  opacity:1;
}

.setores-table th.sortable.desc::after{
  content:'‚ñº';
  opacity:1;
}

.setores-table td{
  padding:14px 12px;
  border-bottom:1px solid #f0f0f0;
  color:#333;
}

.setores-table tbody tr:hover{
  background:#faf8ff;
}

.setores-table tbody tr:last-child td{
  border-bottom:none;
}

.setores-badge{
  display:inline-block;
  padding:5px 12px;
  border-radius:12px;
  font-size:12px;
  font-weight:700;
  text-transform:uppercase;
}

.setores-badge-site{
  background:#e8f5e9;
  color:#2e7d32;
}

.setores-badge-nao-site{
  background:#fff3e0;
  color:#e65100;
}

.setores-ocupacao-baixa{ 
  color:#ff5722 !important; 
  font-weight:700 !important;
  font-size:14px !important;
}
.setores-ocupacao-media{ 
  color:#ff9800 !important; 
  font-weight:700 !important;
  font-size:14px !important;
}
.setores-ocupacao-alta{ 
  color:#4caf50 !important; 
  font-weight:700 !important;
  font-size:14px !important;
}
.setores-ocupacao-completa{ 
  color:#2196f3 !important; 
  font-weight:700 !important;
  font-size:14px !important;
}

.setores-pagination-controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:25px;
  margin:30px 0;
  padding:22px;
  background:#fff;
  border-radius:16px;
  border:2px solid rgba(155,28,219,0.15);
  box-shadow:0 4px 12px rgba(155,28,219,0.08);
}

.setores-pagination-btn{
  padding:14px 28px;
  background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
  color:#fff;
  border:none;
  border-radius:12px;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;
  align-items:center;
  gap:10px;
}

.setores-pagination-btn:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 6px 16px rgba(155,28,219,0.3);
}

.setores-pagination-btn:disabled{
  background:#ccc;
  cursor:not-allowed;
  opacity:0.5;
  transform:none;
}

.setores-pagination-info{
  font-size:16px;
  font-weight:600;
  color:var(--purple);
}

@media (max-width: 1200px) {
  .setores-table th, .setores-table td {
    font-size:12px;
    padding:12px 10px;
  }
}

@media (max-width: 768px) {
  .setores-table-container{
    font-size:11px;
  }
  
  .setores-table th, .setores-table td{
    padding:10px 8px;
    font-size:11px;
  }
  
  .setores-rodada-title{
    font-size:18px;
  }
  
  .setores-jogo-linha{
    font-size:14px;
  }
  
  .setores-meta-info{
    font-size:12px;
  }
}

/* ============================================
   RESPONSIVIDADE - MEDIA QUERIES
============================================ */

/* TABLETS - AT√â 1024px */
@media (max-width: 1024px) {
  .cards-row{grid-template-columns:repeat(2,1fr);}
  .cards-row-today{grid-template-columns:repeat(2,1fr);}
  .distribuicao-cards{grid-template-columns:repeat(2,1fr);}
  #usuariosArea > div:last-child{grid-template-columns:repeat(2,1fr);}
  #sedesContainer{grid-template-columns:repeat(2,1fr) !important;}
}

/* MOBILE - AT√â 768px */
@media (max-width: 768px) {
  body{padding:12px;}
  
/* Top 5 em 1 coluna */
.container > div > div[style*="grid-template-columns:repeat(2,1fr)"] {
    grid-template-columns: 1fr !important;

  .header{flex-direction:column;align-items:flex-start;}
  .header-right{align-items:flex-start;width:100%;}
  .header-right > div{flex-direction:column;width:100%;}
  .refresh-btn, .export-btn{width:100%;}
  
  .title{font-size:22px;}
  .logo{width:60px;height:60px;font-size:28px;}
  
  .cards-row{grid-template-columns:1fr;}
  .cards-row-today{grid-template-columns:1fr;}
  .distribuicao-cards{grid-template-columns:1fr;}
  
  .card-today-flex{height:auto;min-height:120px;padding:18px;}
  .card-today-flex .right .value{font-size:36px;}
  
  .toggle-btn{font-size:11px;padding:8px 14px;}
  
  #usuariosArea > div:last-child{grid-template-columns:1fr;}
  #sedesContainer{grid-template-columns:1fr !important;}
  
  .table-header{flex-direction:column;align-items:flex-start;}
  .table-title{font-size:16px;}
  .rodada-filters{width:100%;}
  .rodada-btn{flex:1;font-size:10px;padding:6px 10px;}
}

/* MOBILE PEQUENO - AT√â 480px */
@media (max-width: 480px) {
  body{padding:8px;}
  
  .card{padding:16px;height:auto;min-height:110px;}
  .card .label{font-size:11px;}
  .card .value{font-size:28px;}
  
  .chart-card{padding:14px;}
  
  .donut-container{height:180px;}
  
  .footer-note{font-size:11px;}
}
</style>
</head>

<body>

<!-- PROGRESS BAR NO TOPO -->
<div id="progressBar"></div>

<div class="container">

<!-- HEADER 
<div class="header">
  <div class="header-left">
    <div class="logo">CM</div>
    <div>
      <div class="title">Copinha Masculina 2026</div>
      <div class="header-sub">Dashboard ‚Ä¢ Dados em tempo real</div>
    </div>
  </div>
  <div class="header-right">
    <div style="display:flex;gap:8px;width:100%;">
      <button class="refresh-btn" id="btnRefresh">üîÑ Atualizar</button>
      <button class="export-btn" id="btnExport">üìÑ Exportar PDF</button>
    </div>
    <div id="loadTimestamp" class="load-info loading">Carregando dados...</div>
  </div>  
</div>-->

<!-- HEADER -->
<div class="header">
    <div class="header-left">
      <img src="logo-copinha.png" alt="Copinha Logo" style="height:72px;border-radius:8px;">
      <div>
        <div class="title">Copinha Masculina 2026</div>
        <div class="header-sub">
          Dashboard ‚Ä¢ <span id="sedeHeaderTexto"></span>Dados em tempo real
        </div>
      </div>
    </div>
    <div class="header-right">
      <div style="display:flex;gap:8px;width:100%;flex-wrap:wrap;justify-content:flex-end;">
        <button class="toggle-btn active" id="btnModoGeral">üåç Geral</button>
        <button class="toggle-btn" id="btnModoSede">üèüÔ∏è Sede</button>
        <button class="refresh-btn" id="btnRefresh">üîÑ Atualizar</button>
        <button class="export-btn" id="btnExport">üìÑ Exportar PDF</button>
      </div>
      <div id="loadTimestamp" class="load-info loading">Carregando dados...</div>
    </div>  
  </div>

<!-- MAIN -->
<div class="top-grid">
  <div class="left-col">

    <!-- CARDS √öLTIMA HORA (COM SKELETON) -->
    <div class="cards-row" id="cardsUltimaHora">
      <!-- Skeleton Loading -->
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
    </div>

    <!-- CARDS HOJE (COM SKELETON) -->
    <div class="cards-row-today" id="cardsHojeWrapper">
      <div class="skeleton-card" style="height:140px;">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
      <div class="skeleton-card" style="height:140px;">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
      <div class="skeleton-card" style="height:140px;">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-value"></div>
      </div>
    </div>
    <!-- GR√ÅFICO EVOLU√á√ÉO DI√ÅRIA (COM SKELETON) -->
    <div class="chart-card" id="chartVendasWrapper">
      <div class="skeleton-chart">
        <div class="skeleton skeleton-chart-title"></div>
        <div class="skeleton skeleton-chart-body"></div>
      </div>
    </div>

    <!-- DISTRIBUI√á√ÉO INGRESSOS -->
    <div class="chart-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:12px;">
        <div style="font-weight:900;color:var(--purple-dark);font-size:18px;display:flex;align-items:center;gap:8px">
          <span style="font-size:24px">üéü</span> Distribui√ß√£o dos Ingressos
        </div>
        <div>
          <button id="btnTotal" class="toggle-btn active">Total</button>
          <button id="btnProximos" class="toggle-btn">Pr√≥ximos Jogos</button>
        </div>
      </div>

      <div class="distribuicao-container">
        <div class="distribuicao-cards">
          <div class="card-dist">
            <div>Total Ingressos</div>
            <div class="value" id="cardTotalIngressos">0</div>
          </div>
          <div class="card-dist">
            <div>Dispon√≠veis</div>
            <div class="value" id="cardDisponiveis">0</div>
            <div class="subpct" id="cardDisponiveisPct"></div>
          </div>
          <div class="card-dist">
            <div>Reservados</div>
            <div class="value" id="cardReservados">0</div>
          </div>
          <div class="card-dist">
            <div>Vendidos</div>
            <div class="value" id="cardVendidos">0</div>
          </div>
        </div>

        <div class="ocupacao-line">Ocupa√ß√£o: <span id="ocupacaoValor">0%</span></div>
      </div>
    </div>

    <!-- SEDES - 4 CARDS COM BARRAS -->
    <div class="chart-card" id="cardSedesGeral" style="margin-top:18px">
      <div style="font-weight:900;color:var(--purple-dark);margin-bottom:16px;font-size:18px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
        <span style="font-size:24px">üèüÔ∏è</span> 
        <span>Sedes - Vendas por Local</span>
        <span style="font-size:14px;font-weight:600;color:#64748b;margin-left:4px;">|</span>
        <span id="sedesModoTexto" style="font-size:15px;font-weight:800;background:linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">
          Total: 0
        </span>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;" id="sedesContainer">
        <!-- Os 4 cards ser√£o preenchidos via JavaScript -->
      </div>
    </div>

    <!-- SETORES - OCUPA√á√ÉO POR JOGO (MODO SEDE) -->
    <div class="chart-card" id="cardSetoresSede" style="margin-top:18px;display:none;">
      <div style="background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);color:white;padding:14px 20px;border-radius:12px;margin-bottom:14px;box-shadow:0 4px 12px rgba(155,28,219,0.3);">
        <div style="display:flex;align-items:center;gap:10px;">
          <span style="font-size:32px;">üé´</span>
          <div>
            <div style="font-weight:900;font-size:20px;letter-spacing:0.5px;">SETORES - OCUPA√á√ÉO POR JOGO</div>
          </div>
        </div>
      </div>
      
      <div id="setoresOcupacaoContainer">
        <!-- Os setores ser√£o preenchidos via JavaScript -->
      </div>
    </div>

    <!-- USU√ÅRIOS / FACIAIS - DONUT CHARTS -->
    <div id="usuariosArea" class="chart-card">
      <div style="font-weight:900;color:var(--purple-dark);margin-bottom:16px;font-size:18px;display:flex;align-items:center;gap:8px">
        <span style="font-size:24px">üë•</span> Usu√°rios / Faciais
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px">
        <!-- Card Base Total -->
        <div class="donut-card">
          <div class="donut-title">Base Total</div>
          <div class="donut-container">
            <canvas id="chartBaseTotal"></canvas>
          </div>
          <div class="donut-legend" id="legendBaseTotal"></div>
        </div>

        <!-- Card Ap√≥s Abertura -->
        <div class="donut-card">
          <div class="donut-title">Ap√≥s Abertura dos Jogos</div>
          <div class="donut-container">
            <canvas id="chartAposAbertura"></canvas>
          </div>
          <div class="donut-legend" id="legendAposAbertura"></div>
        </div>

        <!-- Card Dependentes -->
        <div class="donut-card">
          <div class="donut-title">Dependentes</div>
          <div class="donut-container">
            <canvas id="chartDependentes"></canvas>
          </div>
          <div class="donut-legend" id="legendDependentes"></div>
        </div>
      </div>
    </div>

    <!-- DISTRIBUI√á√ÉO GEOGR√ÅFICA -->
    <div class="chart-card" style="margin-top:18px">
      <div style="font-weight:900;color:var(--purple-dark);margin-bottom:16px;font-size:18px;display:flex;align-items:center;gap:8px">
        <span style="font-size:24px">üó∫Ô∏è</span> Distribui√ß√£o Geogr√°fica
      </div>
      
      <div class="geo-cards-container" id="geoCardsContainer">
        <!-- Card 1: Resumo -->
        <div class="geo-card">
          <div class="geo-card-title">üìä Resumo</div>
          <div class="geo-resumo">
            <div class="geo-resumo-number" id="geoCidadesTotal">0</div>
            <div class="geo-resumo-label">Cidades</div>
            <div style="height:20px;"></div>
            <div class="geo-resumo-number" id="geoEstadosTotal">0</div>
            <div class="geo-resumo-label">Estados</div>
            <div class="geo-resumo-text" id="geoResumoTexto">Cadastros distribu√≠dos por todo estado</div>
          </div>
        </div>
        
        <!-- Card 2: Top 5 Cidades -->
        <div class="geo-card">
          <div class="geo-card-title">üèôÔ∏è Top 5 Cidades</div>
          <div class="geo-list" id="geoCidadesTop5"></div>
        </div>
        
        <!-- Card 3: Top 6-10 Cidades -->
        <div class="geo-card">
          <div class="geo-card-title">üèôÔ∏è Top 6-10 Cidades</div>
          <div class="geo-list" id="geoCidadesTop610"></div>
        </div>
        
        <!-- Card 4: Top 5 Estados -->
        <div class="geo-card">
          <div class="geo-card-title">üó∫Ô∏è Top 5 Estados</div>
          <div class="geo-list" id="geoEstadosTop5"></div>
        </div>
      </div>
    </div>

  </div> <!-- left col -->
</div> <!-- grid -->


<!-- JOGOS MAIS BUSCADOS NA √öLTIMA HORA -->
<div id="cardJogosBuscadosGeral" style="margin-top:20px;margin-bottom:10px;">
  <div style="background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);color:white;padding:14px 20px;border-radius:12px;margin-bottom:14px;box-shadow:0 4px 12px rgba(155,28,219,0.3);">
    <div style="display:flex;align-items:center;gap:10px;">
      <span style="font-size:32px;animation:pulse-fire 2s ease-in-out infinite;">üî•</span>
      <div>
        <div style="font-weight:900;font-size:20px;letter-spacing:0.5px;">JOGOS MAIS BUSCADOS</div>
        <div style="font-size:12px;opacity:0.95;font-weight:600;">√öltima Hora - Tempo Real</div>
      </div>
    </div>
  </div>
  
  <div class="hot-games-container" id="jogosMaisBuscados">
    <!-- Os 3 jogos mais buscados ser√£o preenchidos via JavaScript -->
  </div>
</div>

<!-- TOP 5 MAIORES E MENORES VENDAS -->
<div id="cardTop5Geral" style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:20px;margin-bottom:20px">
  
  <!-- TOP 5 MAIORES VENDAS - ROXO -->
  <div class="chart-card" style="background:linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);border:2px solid rgba(155,28,219,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
      <div style="font-weight:900;color:#9b1cdb;font-size:18px;display:flex;align-items:center;gap:8px">
        <span style="font-size:24px">üî•</span> Top 5 - Maiores Vendas
      </div>
      <button class="toggle-filter-btn" id="toggleMaiores">
        ‚öΩ Jogos Abertos
      </button>
    </div>
    <div id="top5MaioresVendas" style="display:flex;flex-direction:column;gap:10px;"></div>
  </div>
  
  <!-- TOP 5 MENORES VENDAS - AMARELO -->
  <div class="chart-card" style="background:linear-gradient(135deg, #f8e847 0%, #ffed4e 100%);border:2px solid rgba(248,232,71,0.3);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
      <div style="font-weight:900;color:#7a16af;font-size:18px;display:flex;align-items:center;gap:8px">
        <span style="font-size:24px">‚ö†Ô∏è</span> Top 5 - Menores Vendas
      </div>
      <button class="toggle-filter-btn" id="toggleMenores">
        ‚öΩ Jogos Abertos
      </button>
    </div>
    <div id="top5MenoresVendas" style="display:flex;flex-direction:column;gap:10px;"></div>
  </div>
  
</div>

<!-- TABELA DE JOGOS COM FILTRO DE RODADAS -->
<div class="table-wrap">
  <div class="table-header">
    <div class="table-title">‚öΩ Todos os Jogos - Detalhamento Completo</div>
    <div class="rodada-filters">
      <button class="rodada-btn" data-rodada="todas">Todas</button>
      <button class="rodada-btn" data-rodada="1">1¬™ Rodada</button>
      <button class="rodada-btn" data-rodada="2">2¬™ Rodada</button>
      <button class="rodada-btn" data-rodada="3">3¬™ Rodada</button>
    </div>
  </div>
  <div class="table-container">
    <table id="tabelaJogos">
      <thead>
        <tr>
          <th style="text-align:left">C√≥digo</th>
          <th class="sortable" data-column="sede" style="text-align:left">Sede</th>
          <th class="sortable" data-column="grupo" style="text-align:left">Grupo</th>
          <th style="text-align:left">Jogos</th>
          <th class="sortable" data-column="data" style="text-align:center">Data/Hora</th>
          <th class="sortable" data-column="livre" style="text-align:center">Livre</th>
          <th class="sortable" data-column="reservado" style="text-align:center">Reservado</th>
          <th class="sortable" data-column="confirmado" style="text-align:center">Confirmado</th>
          <th class="sortable" data-column="acessos" style="text-align:center">Acessos</th>
          <th class="sortable" data-column="ocupacao" style="text-align:center">Ocupa√ß√£o</th>
          <th class="sortable" data-column="status" style="text-align:center">Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="footer-note">Dashboard atualizado automaticamente ‚Ä¢ Copinha Masculina 2026 ‚Ä¢ üíª Desenvolvido por Wagner Pequeneza Junior</div>

</div> <!-- container -->

<script>
/* ============================================
   CONFIGURA√á√ÉO DA API
============================================ */
const API_URL_GERAL = 'https://soudaliga.ligatechapis.com/api/public/Dash/DashBoardCopinha';
const API_URL_SEDE = 'https://soudaliga.ligatechapis.com/api/public/Dash/DashBoardCopinhaSede';

/* ============================================
   VARI√ÅVEIS GLOBAIS
============================================ */
let jsonData = null;
let chartVendas = null;
let chartBaseTotal = null;
let chartAposAbertura = null;
let chartDependentes = null;
let distribMode = "total";
let rodadaFiltro = null; // Come√ßa null para n√£o renderizar tabela inicialmente
let sortColumn = null; // Coluna de ordena√ß√£o atual
let sortDirection = 'asc'; // Dire√ß√£o de ordena√ß√£o atual
let dadosOriginais = []; // Guarda os dados originais para ordena√ß√£o
let setoresPaginaAtual = 0; // Pagina√ß√£o dos setores
let setoresOrdenacao = { coluna: null, direcao: 'asc' }; // Ordena√ß√£o dos setores


// Vari√°veis para controle de modo (Geral vs Sede)
let modoAtual = 'geral'; // 'geral' ou 'sede'
let sedeAtual = null; // Nome da sede quando em modo sede

/* ============================================
   PROGRESS BAR - CONTROLES
============================================ */
function setProgress(percent) {
  const progressBar = document.getElementById('progressBar');
  progressBar.style.width = percent + '%';
  
  if (percent >= 100) {
    setTimeout(() => {
      progressBar.style.width = '0%';
    }, 500);
  }
}

function hideSkeletons() {
  // Remove skeleton do gr√°fico de vendas
  const chartWrapper = document.getElementById('chartVendasWrapper');
  if (chartWrapper) {
    const skeletonChart = chartWrapper.querySelector('.skeleton-chart');
    if (skeletonChart) {
      skeletonChart.remove();
      // Adiciona o canvas real
      chartWrapper.innerHTML = `
        <div style="font-weight:900;color:var(--purple-dark);margin-bottom:12px;font-size:18px;display:flex;align-items:center;gap:8px">
          <span style="font-size:24px">üìä</span> Evolu√ß√£o Di√°ria - Vendas, Cadastros e Faciais
        </div>
        <div class="chart-wrap" style="height:300px"><canvas id="chartVendasDia"></canvas></div>
      `;
    }
  }
}

/* ============================================
   HELPERS
============================================ */
function formatNumber(n){ return Number(n||0).toLocaleString("pt-BR"); }

function pctChange(today, yesterday){
  if (yesterday === 0) return { val: 0, txt: "0.00%" };
  const p = ((today - yesterday) / yesterday) * 100;
  return { val: p, txt: (p).toFixed(2) + "%" };
}

function escapeHtml(s){
  if(s === null || s === undefined) return "";
  return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

/* ============================================
   CARREGAMENTO DA API COM PROGRESS BAR
============================================ */
async function carregarDadosAPI(){
  const btnRefresh = document.getElementById("btnRefresh");
  const loadTimestamp = document.getElementById("loadTimestamp");
  
  try {
    // Desabilita bot√£o
    btnRefresh.disabled = true;
    loadTimestamp.textContent = "üîÑ Carregando da API...";
    loadTimestamp.classList.add("loading");
    
    // Inicia progress bar
    setProgress(0);
    
    // Simula progresso inicial
    setProgress(10);
    
    // Define a URL baseada no modo
    let url = API_URL_GERAL;
    if(modoAtual === 'sede' && sedeAtual){
      url = `${API_URL_SEDE}?SedeDominio=${encodeURIComponent(sedeAtual)}`;
    }
    
    
    // Faz a requisi√ß√£o
    const response = await fetch(url);
    setProgress(30);
    
    // Parse do JSON
    const data = await response.json();
    setProgress(60);
    
    // Verifica se a API retornou erro
    if(data.code && data.code < 0){
      throw new Error(data.message || 'Erro desconhecido da API');
    }
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    jsonData = data;
    
    // Remove skeletons
    hideSkeletons();
    setProgress(70);
    
    // Renderiza tudo
    renderAll();
    setProgress(100);
    
    // Atualiza timestamp (sem mostrar sede)
    loadTimestamp.textContent = `‚úÖ Dados atualizados via API ‚Ä¢ ${new Date().toLocaleString("pt-BR")}`;
    loadTimestamp.classList.remove("loading");
    
  } catch (error) {
    
    setProgress(0);
    loadTimestamp.textContent = "‚ùå Erro ao carregar API";
    loadTimestamp.classList.remove("loading");
    
    alert(
      "‚ùå N√£o foi poss√≠vel carregar os dados da API.\n\n" +
      "Erro: " + error.message
    );
    
  } finally {
    btnRefresh.disabled = false;
  }
}

/* ============================================
   NORMALIZAR DADOS
============================================ */
function normalizarDados(data) {
  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }
  
  function normalizarArray(arr) {
    if (!Array.isArray(arr)) return arr;
    return arr.map(obj => {
      const newObj = {};
      for (let key in obj) {
        const newKey = capitalize(key);
        newObj[newKey] = obj[key];
      }
      return newObj;
    });
  }
  
  if (data.CardsInicial || data.CardsInicialSede) {
    return data;
  }
  
  return {
    CardsInicial: normalizarArray(data.cardsInicial || data.CardsInicial || []),
    CardsInicialSede: normalizarArray(data.cardsInicialSede || data.CardsInicialSede || []),
    DadosporDia: normalizarArray(data.dadosporDia || data.DadosporDia || data.dadosporDiaSede || data.DadosporDiaSede || []),
    DistribuicaoTotal: normalizarArray(data.distribuicaoTotal || data.DistribuicaoTotal || data.distribuicaoTotalSede || data.DistribuicaoTotalSede || []),
    DistribuicaoProximos: normalizarArray(data.distribuicaoProximos || data.DistribuicaoProximos || data.distribuicaoProximosSede || data.DistribuicaoProximosSede || []),
    SedesTotal: normalizarArray(data.sedesTotal || data.SedesTotal || data.sedesTotalSede || data.SedesTotalSede || []),
    SedesProximos: normalizarArray(data.sedesProximos || data.SedesProximos || data.sedesProximosSede || data.SedesProximosSede || []),
    GruposTotal: normalizarArray(data.gruposTotal || data.GruposTotal || []),
    GruposProximos: normalizarArray(data.gruposProximos || data.GruposProximos || []),
    UsuariosCadastrados: normalizarArray(data.usuariosCadastrados || data.UsuariosCadastrados || data.usuariosCadastradosSede || data.UsuariosCadastradosSede || []),
    Dependentes: normalizarArray(data.dependentes || data.Dependentes || data.dependentesSede || data.DependentesSede || []),
    FaciaisAposAberturadosJogos: normalizarArray(data.faciaisAposAberturadosJogos || data.FaciaisAposAberturadosJogos || data.faciaisAposAberturadosJogosSede || data.FaciaisAposAberturadosJogosSede || []),
    Jogos: normalizarArray(data.jogos || data.Jogos || data.jogosSede || data.JogosSede || []),
    jogosMaisBuscadosUltimaHora: normalizarArray(data.jogosMaisBuscadosUltimaHora || data.JogosMaisBuscadosUltimaHora || []),
    distribuicaoGeograficaCidades: normalizarArray(data.distribuicaoGeograficaCidades || data.DistribuicaoGeograficaCidades || data.distribuicaoGeograficaCidadesSede || data.DistribuicaoGeograficaCidadesSede || []),
    distribuicaoGeograficaEstados: normalizarArray(data.distribuicaoGeograficaEstados || data.DistribuicaoGeograficaEstados || data.distribuicaoGeograficaEstadosSede || data.DistribuicaoGeograficaEstadosSede || []),
    SetoresSede: normalizarArray(data.setoresSede || data.SetoresSede || []),
    JogosSede: normalizarArray(data.jogosSede || data.JogosSede || [])
  };
}

/* ============================================
   RENDER PRINCIPAL
============================================ */
function renderAll(){
  if(!jsonData) {
    return;
  }
  
  jsonData = normalizarDados(jsonData);
  
  
  // Controla visibilidade dos cards baseado no modo
  if(modoAtual === 'geral'){
    // Mostra cards do modo geral
    document.getElementById('cardSedesGeral').style.display = 'block';
    document.getElementById('cardJogosBuscadosGeral').style.display = 'block';
    document.getElementById('cardTop5Geral').style.display = 'grid';
    
    // Oculta cards do modo sede
    document.getElementById('cardSetoresSede').style.display = 'none';
  } else {
    // Oculta cards do modo geral
    document.getElementById('cardSedesGeral').style.display = 'none';
    document.getElementById('cardJogosBuscadosGeral').style.display = 'none';
    document.getElementById('cardTop5Geral').style.display = 'none';
    
    // Mostra cards do modo sede
    document.getElementById('cardSetoresSede').style.display = 'block';
    
    // Atualiza header com nome da sede vindo da API
    // SedesTotal j√° vem normalizado de sedesTotalSede
    const sedesTotal = jsonData.SedesTotal || [];
    if(sedesTotal.length > 0){
      const nomeSede = sedesTotal[0].Sede || sedesTotal[0].sede || '';
      const sedeHeaderEl = document.getElementById("sedeHeaderTexto");
      if(sedeHeaderEl && nomeSede){
        sedeHeaderEl.innerHTML = `üèüÔ∏è <span style="font-weight:900;color:white;font-size:15px;">${nomeSede}</span> ‚Ä¢ `;
      }
    }
  }
  
  
  try { renderCardsV3(); } catch(e){ }
  try { renderChartVendasDia(); } catch(e){ }
  try { renderDistribuicao(distribMode); } catch(e){ }
  
  // Renderiza Sedes apenas no modo geral
  if(modoAtual === 'geral'){
    try { renderSedesCards("total"); } catch(e){ }
    try { renderJogosMaisBuscados(); } catch(e){ }
    try { renderTop5Insights(); } catch(e){ }
  }
  
  // Renderiza Setores apenas no modo sede
  if(modoAtual === 'sede'){
    try { renderSetoresSede(); } catch(e){ }
  }
  
  try { renderDonutCharts(); } catch(e){ }
  try { renderDistribuicaoGeografica(); } catch(e){ }
  try { renderTabelaJogos(rodadaFiltro); } catch(e){ }
}

/* ============================================
   RENDER CARDS √öLTIMA HORA E HOJE
============================================ */
function renderCardsV3(){
  const c = jsonData.CardsInicial?.[0] || jsonData.CardsInicialSede?.[0] || {};

  document.getElementById("cardsUltimaHora").innerHTML = `
    <div class="card">
      <div class="label"><span>üõí</span> Vendas √öltima Hora</div>
      <div class="value">${formatNumber(c.VendasUltimaHora||0)}</div>
    </div>
    <div class="card">
      <div class="label"><span>üë•</span> Usu√°rios √öltima Hora</div>
      <div class="value">${formatNumber(c.UsuariosUltimaHora||0)}</div>
    </div>
    <div class="card">
      <div class="label"><span>üì∏</span> Faciais √öltima Hora</div>
      <div class="value">${formatNumber(c.FaciaisUltimaHora||0)}</div>
    </div>
    <div class="card reservas">
      <div class="label"><span>üîí</span> Reservas Ativas</div>
      <div class="value">${formatNumber(c.ReservasAtivas||0)}</div>
    </div>
  `;

  const vendasPctObj = pctChange(c.VendasHoje||0, c.VendasOntem||0);
  const usuariosPctObj = pctChange(c.UsuariosHoje||0, c.UsuariosOntem||0);
  const faciaisPctObj = pctChange(c.FaciaisHoje||0, c.FaciaisOntem||0);
  
  const vendasClass = vendasPctObj.val >= 0 ? 'positive' : 'negative';
  const usuariosClass = usuariosPctObj.val >= 0 ? 'positive' : 'negative';
  const faciaisClass = faciaisPctObj.val >= 0 ? 'positive' : 'negative';
  
  const vendasIcon = vendasPctObj.val >= 0 ? 'üìà' : 'üìâ';
  const usuariosIcon = usuariosPctObj.val >= 0 ? 'üìà' : 'üìâ';
  const faciaisIcon = faciaisPctObj.val >= 0 ? 'üìà' : 'üìâ';

  document.getElementById("cardsHojeWrapper").innerHTML = `
    <div class="card-today-flex">
      <div class="left">
        <div class="label">üõí Vendas Hoje</div>
        <div class="sub ${vendasClass}">${vendasIcon} ${vendasPctObj.txt} vs ontem</div>
      </div>
      <div class="right"><div class="value">${formatNumber(c.VendasHoje||0)}</div></div>
    </div>

    <div class="card-today-flex">
      <div class="left">
        <div class="label">üë• Usu√°rios Hoje</div>
        <div class="sub ${usuariosClass}">${usuariosIcon} ${usuariosPctObj.txt} vs ontem</div>
      </div>
      <div class="right"><div class="value">${formatNumber(c.UsuariosHoje||0)}</div></div>
    </div>

    <div class="card-today-flex">
      <div class="left">
        <div class="label">üì∏ Faciais Hoje</div>
        <div class="sub ${faciaisClass}">${faciaisIcon} ${faciaisPctObj.txt} vs ontem</div>
      </div>
      <div class="right"><div class="value">${formatNumber(c.FaciaisHoje||0)}</div></div>
    </div>
  `;
}

/* ============================================
   RENDER DISTRIBUI√á√ÉO GEOGR√ÅFICA
============================================ */
function renderDistribuicaoGeografica(){
  
  const cidades = jsonData.distribuicaoGeograficaCidades || jsonData.DistribuicaoGeograficaCidades || [];
  const estados = jsonData.distribuicaoGeograficaEstados || jsonData.DistribuicaoGeograficaEstados || [];
  
  
  if(!cidades || cidades.length === 0){
  }
  if(!estados || estados.length === 0){
  }
  
  // Card 1: Resumo
  const totalCidades = cidades.length > 0 ? (cidades[0].totalCidades || cidades[0].TotalCidades || cidades.length) : 0;
  const totalEstados = estados.length > 0 ? (estados[0].totalEstados || estados[0].TotalEstados || estados.length) : 0;
  
  
  const cidadesTotalEl = document.getElementById('geoCidadesTotal');
  const estadosTotalEl = document.getElementById('geoEstadosTotal');
  const resumoTextoEl = document.getElementById('geoResumoTexto');
  
  if(cidadesTotalEl) cidadesTotalEl.textContent = totalCidades;
  if(estadosTotalEl) estadosTotalEl.textContent = totalEstados;
  
  // Atualiza texto do resumo baseado nos dados
  const estadoPrincipal = estados.length > 0 ? (estados[0].estado || estados[0].Estado || '') : '';
  const percentualPrincipal = estados.length > 0 ? (estados[0].percentual || estados[0].Percentual || '') : '';
  
  
  if(estadoPrincipal && percentualPrincipal && resumoTextoEl){
    resumoTextoEl.textContent = `${percentualPrincipal} dos cadastros em ${estadoPrincipal}`;
  }
  
  // Card 2: Top 5 Cidades (posi√ß√µes 1-5)
  const top5Cidades = cidades.slice(0, 5);
  const cidadesTop5El = document.getElementById('geoCidadesTop5');
  
  if(cidadesTop5El){
    cidadesTop5El.innerHTML = top5Cidades.map((cidade, index) => {
      const nomeCidade = cidade.cidade || cidade.Cidade || 'N/A';
      const percentual = cidade.percentual || cidade.Percentual || '0%';
      return `
        <div class="geo-item">
          <div class="geo-item-pos">${index + 1}</div>
          <div class="geo-item-name" title="${nomeCidade}">${nomeCidade}</div>
          <div class="geo-item-percent">${percentual}</div>
        </div>
      `;
    }).join('');
  }
  
  // Card 3: Top 6-10 Cidades (posi√ß√µes 6-10)
  const top610Cidades = cidades.slice(5, 10);
  const cidadesTop610El = document.getElementById('geoCidadesTop610');
  
  if(cidadesTop610El){
    cidadesTop610El.innerHTML = top610Cidades.map((cidade, index) => {
      const nomeCidade = cidade.cidade || cidade.Cidade || 'N/A';
      const percentual = cidade.percentual || cidade.Percentual || '0%';
      return `
        <div class="geo-item">
          <div class="geo-item-pos">${index + 6}</div>
          <div class="geo-item-name" title="${nomeCidade}">${nomeCidade}</div>
          <div class="geo-item-percent">${percentual}</div>
        </div>
      `;
    }).join('');
  }
  
  // Card 4: Top 5 Estados
  const top5Estados = estados.slice(0, 5);
  const estadosTop5El = document.getElementById('geoEstadosTop5');
  
  if(estadosTop5El){
    estadosTop5El.innerHTML = top5Estados.map((estado, index) => {
      const nomeEstado = estado.estado || estado.Estado || 'N/A';
      const percentual = estado.percentual || estado.Percentual || '0%';
      return `
        <div class="geo-item">
          <div class="geo-item-pos">${index + 1}</div>
          <div class="geo-item-name">${nomeEstado}</div>
          <div class="geo-item-percent">${percentual}</div>
        </div>
      `;
    }).join('');
  }
  
}

/* ============================================
   RENDER JOGOS MAIS BUSCADOS NA √öLTIMA HORA
============================================ */
function renderJogosMaisBuscados(){
  const container = document.getElementById('jogosMaisBuscados');
  const secao = document.getElementById('cardJogosBuscadosGeral');
  
  if(!container || !secao) {
    return;
  }
  
  
  const jogosBuscados = jsonData.jogosMaisBuscadosUltimaHora || [];
  const todosJogos = jsonData.Jogos || [];
  
  
  if(!jogosBuscados || jogosBuscados.length === 0){
    // Esconde a se√ß√£o completa quando n√£o tem dados
    secao.style.display = 'none';
    return;
  }
  
  // Mostra a se√ß√£o quando tem dados
  secao.style.display = 'block';
  
  // Busca os 3 jogos mais buscados (pega no m√°ximo 3)
  const top3 = jogosBuscados.slice(0, 3);
  
  container.innerHTML = top3.map((buscado, index) => {
    
    // Tenta encontrar o jogo de v√°rias formas
    const codigoBuscado = buscado.codigoEVE || buscado.CodigoEVE;
    
    const jogo = todosJogos.find(j => {
      const codigoJogo = j.CodigoEVE || j.codigoEVE;
      return Number(codigoJogo) === Number(codigoBuscado);
    });
    
    
    if(!jogo){
      return `<div class="hot-game-card">
        <div style="text-align:center;padding:20px;">
          <div style="font-size:24px;margin-bottom:10px;">‚ö†Ô∏è</div>
          <div style="color:#999;font-size:12px;">Jogo #${codigoBuscado}</div>
          <div style="color:#999;font-size:11px;margin-top:5px;">Dados n√£o encontrados</div>
        </div>
      </div>`;
    }
    
    const codigo = jogo.CodigoEVE || jogo.codigoEVE || '';
    const sede = jogo.Sede || jogo.Local || 'N/A';
    const grupo = jogo.Grupo || 'N/A';
    const rodadaDupla = jogo.RodadaDupla || jogo.Rodada || '';
    const dataEvento = jogo.DataEvento || '';
    
    // Separar data e hora
    let dataFormatada = dataEvento;
    let horaFormatada = '';
    if(dataEvento && dataEvento.includes(' ')){
      const partes = dataEvento.split(' ');
      dataFormatada = partes[0];
      horaFormatada = partes.slice(1).join(' ');
    }
    
    const livres = Number(jogo.Livres || jogo.Livre || jogo.LivresTotal || 0);
    const reservados = Number(jogo.Reservados || jogo.Reservado || 0);
    const confirmados = Number(jogo.Confirmados || jogo.Impressos || jogo.Impresso || jogo.ImpressosTotal || 0);
    const total = livres + reservados + confirmados;
    const ocupacao = total > 0 ? ((confirmados / total) * 100).toFixed(1) + '%' : '0%';
    
    // Extrai os jogos
    const jogosArray = rodadaDupla.split('|').filter(jogo => !jogo.match(/^\d+¬™ Rodada/i));
    const jogosTexto = jogosArray.map(jogo => jogo.trim()).join(' | ') || 'N/A';
    
    // Captura totalComprasReservas com todas as varia√ß√µes poss√≠veis
    const totalComprasReservas = buscado.totalComprasReservas || buscado.TotalComprasReservas || buscado.TotalcomprasReservas || 0;
    
    const badges = ['#1 ü•á', '#2 ü•à', '#3 ü•â'];
    
    
    return `
      <div class="hot-game-card">
        <div class="hot-game-header">
          <div class="hot-game-codigo">#${codigo}</div>
          <div class="hot-game-badge">${badges[index] || '#' + (index + 1)}</div>
        </div>
        
        <div class="hot-game-info">
          <strong>‚öΩ ${jogosTexto}</strong>
        </div>
        
        <div class="hot-game-info">
          üìç <strong>Sede:</strong> ${sede}<br>
          üß© <strong>Grupo:</strong> ${grupo}
        </div>
        
        <div class="hot-game-info" style="padding-bottom:8px;margin-bottom:8px;border-bottom:1px solid rgba(255,82,82,0.15);">
          üìÖ ${dataFormatada}<br>
          ${horaFormatada ? `‚è∞ ${horaFormatada}` : ''}
        </div>
        
        <div class="hot-game-stats">
          <div class="hot-stat">
            <span class="hot-stat-label">Livre</span>
            <span class="hot-stat-value">${formatNumber(livres)}</span>
          </div>
          <div class="hot-stat">
            <span class="hot-stat-label">Reservado</span>
            <span class="hot-stat-value">${formatNumber(reservados)}</span>
          </div>
          <div class="hot-stat">
            <span class="hot-stat-label">Confirmado</span>
            <span class="hot-stat-value">${formatNumber(confirmados)}</span>
          </div>
          <div class="hot-stat">
            <span class="hot-stat-label">Ocupa√ß√£o</span>
            <span class="hot-stat-value">${ocupacao}</span>
          </div>
        </div>
        
        <div style="margin-top:12px;background:linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);color:white;padding:10px;border-radius:8px;text-align:center;box-shadow:0 3px 10px rgba(155,28,219,0.3);">
          <div style="font-size:10px;font-weight:700;opacity:0.9;margin-bottom:4px;">üî• √öLTIMA HORA</div>
          <div style="font-size:20px;font-weight:900;">${formatNumber(totalComprasReservas)}</div>
          <div style="font-size:9px;font-weight:600;opacity:0.85;margin-top:2px;">Compras + Reservas</div>
        </div>
      </div>
    `;
  }).join('');
  
}

/* ============================================
   RENDER SETORES - OCUPA√á√ÉO POR JOGO (MODO SEDE)
============================================ */
function renderSetoresSede(){
  const setores = jsonData.SetoresSede || jsonData.setoresSede || [];
  const jogos = jsonData.JogosSede || jsonData.jogosSede || [];
  
  if(!setores || setores.length === 0 || !jogos || jogos.length === 0){
    document.getElementById('setoresOcupacaoContainer').innerHTML = '<p style="text-align:center;color:#666;padding:40px;">Nenhum setor encontrado.</p>';
    return;
  }
  
  // Agrupa setores por codigoEVE
  const setoresPorJogo = {};
  setores.forEach(s => {
    const codigo = s.codigoEVE || s.CodigoEVE;
    if(!setoresPorJogo[codigo]){
      setoresPorJogo[codigo] = [];
    }
    
    const nomeSetor = s.setor || s.Setor || '';
    const vendidos = s.confirmados || s.Confirmados || 0;
    
    // Filtra setores "------------" e setores com 0 vendidos
    if(!nomeSetor.includes('------------') && vendidos > 0){
      setoresPorJogo[codigo].push(s);
    }
  });
  
  // Ordena jogos por data DECRESCENTE (mais recentes primeiro - Rodada 3, 2, 1)
  const jogosOrdenados = [...jogos].sort((a, b) => {
    const dataA = a.dataEvento || a.DataEvento || '';
    const dataB = b.dataEvento || b.DataEvento || '';
    return dataB.localeCompare(dataA);
  });
  
  // Pagina√ß√£o - uma rodada por p√°gina
  const totalPaginas = jogosOrdenados.length;
  const jogoAtual = jogosOrdenados[setoresPaginaAtual];
  
  if(!jogoAtual){
    document.getElementById('setoresOcupacaoContainer').innerHTML = '<p style="text-align:center;color:#666;padding:40px;">Nenhum jogo encontrado.</p>';
    return;
  }
  
  // Dados do jogo atual
  const codigo = jogoAtual.codigoEVE || jogoAtual.CodigoEVE;
  const sede = jogoAtual.sede || jogoAtual.Sede || 'N/A';
  const grupo = jogoAtual.grupo || jogoAtual.Grupo || 'N/A';
  const dataEvento = jogoAtual.dataEvento || jogoAtual.DataEvento || '';
  const rodadaDupla = jogoAtual.rodadaDupla || jogoAtual.RodadaDupla || '';
  const rodada = jogoAtual.rodada || jogoAtual.Rodada || '';
  
  // Separa data e hora
  let dataFormatada = dataEvento;
  let horaFormatada = '';
  if(dataEvento && dataEvento.includes(' - ')){
    const partes = dataEvento.split(' - ');
    dataFormatada = partes[0];
    horaFormatada = partes[1] || '';
  }
  
  // Extrai os jogos
  const jogosArray = rodadaDupla.split('|').map(j => j.trim());
  const jogosHTML = jogosArray.map(jogo => `<div class="setores-jogo-linha">‚öΩ ${escapeHtml(jogo)}</div>`).join('');
  
  // Pega os setores deste jogo e aplica ordena√ß√£o se houver
  let setoresJogo = setoresPorJogo[codigo] || [];
  
  // Aplica ordena√ß√£o se houver
  if(setoresOrdenacao.coluna){
    setoresJogo = [...setoresJogo].sort((a, b) => {
      let valA, valB;
      
      switch(setoresOrdenacao.coluna){
        case 'setor':
          valA = (a.setor || a.Setor || '').toLowerCase();
          valB = (b.setor || b.Setor || '').toLowerCase();
          break;
        case 'carga':
          valA = Number(a.totalIngressos || a.TotalIngressos || 0);
          valB = Number(b.totalIngressos || b.TotalIngressos || 0);
          break;
        case 'livres':
          valA = Number(a.livres || a.Livres || 0);
          valB = Number(b.livres || b.Livres || 0);
          break;
        case 'reservas':
          valA = Number(a.reservados || a.Reservados || 0);
          valB = Number(b.reservados || b.Reservados || 0);
          break;
        case 'vendidos':
          valA = Number(a.confirmados || a.Confirmados || 0);
          valB = Number(b.confirmados || b.Confirmados || 0);
          break;
        case 'ocupacao':
          valA = parseFloat((a.ocupacaoSetor || a.OcupacaoSetor || '0').replace('%','').replace(',','.'));
          valB = parseFloat((b.ocupacaoSetor || b.OcupacaoSetor || '0').replace('%','').replace(',','.'));
          break;
        case 'acessos':
          valA = Number(a.quantidadeEntradas || a.QuantidadeEntradas || 0);
          valB = Number(b.quantidadeEntradas || b.QuantidadeEntradas || 0);
          break;
        case 'percentualAcesso':
          valA = parseFloat((a.percentualAcesso || a.PercentualAcesso || '0').replace('%','').replace(',','.'));
          valB = parseFloat((b.percentualAcesso || b.PercentualAcesso || '0').replace('%','').replace(',','.'));
          break;
        default:
          return 0;
      }
      
      if(typeof valA === 'string'){
        return setoresOrdenacao.direcao === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
      } else {
        return setoresOrdenacao.direcao === 'asc' ? valA - valB : valB - valA;
      }
    });
  }
  
  // Renderiza tabela de setores
  const tabelaHTML = setoresJogo.length > 0 ? `
    <div class="setores-table-container">
      <table class="setores-table">
        <thead>
          <tr>
            <th class="sortable ${setoresOrdenacao.coluna === 'setor' ? setoresOrdenacao.direcao : ''}" data-column="setor">Setor</th>
            <th>Origem</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'carga' ? setoresOrdenacao.direcao : ''}" data-column="carga">Carga</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'livres' ? setoresOrdenacao.direcao : ''}" data-column="livres">Livres</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'reservas' ? setoresOrdenacao.direcao : ''}" data-column="reservas">Reservas</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'vendidos' ? setoresOrdenacao.direcao : ''}" data-column="vendidos">Vendidos</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'ocupacao' ? setoresOrdenacao.direcao : ''}" data-column="ocupacao">Ocupa√ß√£o</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'acessos' ? setoresOrdenacao.direcao : ''}" data-column="acessos">Acessos</th>
            <th class="sortable ${setoresOrdenacao.coluna === 'percentualAcesso' ? setoresOrdenacao.direcao : ''}" data-column="percentualAcesso">% Acesso</th>
          </tr>
        </thead>
        <tbody>
          ${setoresJogo.map(s => {
            const nomeSetor = s.setor || s.Setor || 'Setor';
            const origem = s.origem || s.Origem || 'N/A';
            const carga = s.totalIngressos || s.TotalIngressos || 0;
            const livres = s.livres || s.Livres || 0;
            const reservas = s.reservados || s.Reservados || 0;
            const vendidos = s.confirmados || s.Confirmados || 0;
            const ocupacao = s.ocupacaoSetor || s.OcupacaoSetor || '0%';
            const acessos = s.quantidadeEntradas || s.QuantidadeEntradas || 0;
            const percentualAcesso = s.percentualAcesso || s.PercentualAcesso || '0%';
            
            // Converte para n√∫mero
            const ocupacaoNum = parseFloat(ocupacao.replace('%', '').replace(',', '.'));
            const acessoNum = parseFloat(percentualAcesso.replace('%', '').replace(',', '.'));
            
            // Define classe de cor para ocupa√ß√£o
            let ocupacaoClass = 'setores-ocupacao-baixa';
            if(ocupacaoNum > 95) ocupacaoClass = 'setores-ocupacao-completa';
            else if(ocupacaoNum > 70) ocupacaoClass = 'setores-ocupacao-alta';
            else if(ocupacaoNum > 40) ocupacaoClass = 'setores-ocupacao-media';
            
            // Define classe de cor para % acesso
            let acessoClass = 'setores-ocupacao-baixa';
            if(acessoNum > 95) acessoClass = 'setores-ocupacao-completa';
            else if(acessoNum > 70) acessoClass = 'setores-ocupacao-alta';
            else if(acessoNum > 40) acessoClass = 'setores-ocupacao-media';
            
            // Badge de origem
            const origemBadge = origem.toLowerCase() === 'site' 
              ? `<span class="setores-badge setores-badge-site">Site</span>`
              : `<span class="setores-badge setores-badge-nao-site">PDVs</span>`;
            
            return `
              <tr>
                <td>${escapeHtml(nomeSetor)}</td>
                <td>${origemBadge}</td>
                <td>${formatNumber(carga)}</td>
                <td>${formatNumber(livres)}</td>
                <td>${formatNumber(reservas)}</td>
                <td>${formatNumber(vendidos)}</td>
                <td class="${ocupacaoClass}">${ocupacao}</td>
                <td>${formatNumber(acessos)}</td>
                <td class="${acessoClass}">${percentualAcesso}</td>
              </tr>
            `;
          }).join('')}
        </tbody>
      </table>
    </div>
  ` : '<div style="text-align:center;color:#999;font-size:14px;padding:20px;">Nenhum setor dispon√≠vel</div>';
  
  // Renderiza o card completo com RODADA NA DIREITA
  const cardHTML = `
    <div class="setores-rodada-card">
      <div class="setores-rodada-header">
        <div class="setores-rodada-title-container">
          <div class="setores-jogos-info">
            ${jogosHTML}
          </div>
          <div class="setores-rodada-title">Rodada ${rodada}</div>
        </div>
        <div class="setores-meta-info">
          <div class="setores-meta-item">üìç ${escapeHtml(sede)}</div>
          <div class="setores-meta-item">üß© ${escapeHtml(grupo)}</div>
          <div class="setores-meta-item">üìÖ ${escapeHtml(dataFormatada)}</div>
          <div class="setores-meta-item">üïê ${escapeHtml(horaFormatada)}</div>
        </div>
      </div>
      ${tabelaHTML}
    </div>
  `;
  
  // Controles de pagina√ß√£o EMBAIXO
  const paginacaoHTML = `
    <div class="setores-pagination-controls">
      <button class="setores-pagination-btn" id="setoresAnterior" ${setoresPaginaAtual === 0 ? 'disabled' : ''}>
        ‚Üê Anterior
      </button>
      <div class="setores-pagination-info">
        Rodada ${rodada} de ${totalPaginas}
      </div>
      <button class="setores-pagination-btn" id="setoresProxima" ${setoresPaginaAtual === totalPaginas - 1 ? 'disabled' : ''}>
        Pr√≥xima ‚Üí
      </button>
    </div>
  `;
  
  // Renderiza no container
  document.getElementById('setoresOcupacaoContainer').innerHTML = cardHTML + paginacaoHTML;
  
  // Adiciona event listeners aos bot√µes
  const btnAnterior = document.getElementById('setoresAnterior');
  const btnProxima = document.getElementById('setoresProxima');
  
  if(btnAnterior){
    btnAnterior.addEventListener('click', () => {
      if(setoresPaginaAtual > 0){
        setoresPaginaAtual--;
        renderSetoresSede();
      }
    });
  }
  
  if(btnProxima){
    btnProxima.addEventListener('click', () => {
      if(setoresPaginaAtual < totalPaginas - 1){
        setoresPaginaAtual++;
        renderSetoresSede();
      }
    });
  }
  
  // Adiciona event listeners para ordena√ß√£o
  document.querySelectorAll('.setores-table th.sortable').forEach(th => {
    th.addEventListener('click', () => {
      const coluna = th.getAttribute('data-column');
      
      // Se clicou na mesma coluna, inverte dire√ß√£o
      if(setoresOrdenacao.coluna === coluna){
        setoresOrdenacao.direcao = setoresOrdenacao.direcao === 'asc' ? 'desc' : 'asc';
      } else {
        // Nova coluna, come√ßa com ascendente
        setoresOrdenacao.coluna = coluna;
        setoresOrdenacao.direcao = 'asc';
      }
      
      // Re-renderiza com nova ordena√ß√£o
      renderSetoresSede();
    });
  });
}


/* ============================================
   RENDER TOP 5 MAIORES E MENORES VENDAS
============================================ */
// Vari√°veis de estado dos filtros
let filtroMaioresAbertos = false;
let filtroMenoresAbertos = false;

function renderTop5Insights(){
  let jogos = jsonData.Jogos || [];
  
  // Aplica filtro de "Maiores Vendas" se ativo
  const jogosMaiores = filtroMaioresAbertos 
    ? jogos.filter(j => (j.StatusEvento || '').toLowerCase() === 'aberto')
    : jogos;
  
  // Aplica filtro de "Menores Vendas" se ativo
  const jogosMenores = filtroMenoresAbertos 
    ? jogos.filter(j => (j.StatusEvento || '').toLowerCase() === 'aberto')
    : jogos;
  
  // Ordena jogos maiores por vendidos
  const todosPorVendidosMaiores = [...jogosMaiores].sort((a, b) => {
    const vendA = Number(a.Confirmados || a.Impressos || a.ImpressosTotal || 0);
    const vendB = Number(b.Confirmados || b.Impressos || b.ImpressosTotal || 0);
    return vendB - vendA;
  });
  
  // Ordena jogos menores por vendidos
  const todosPorVendidosMenores = [...jogosMenores].sort((a, b) => {
    const vendA = Number(a.Confirmados || a.Impressos || a.ImpressosTotal || 0);
    const vendB = Number(b.Confirmados || b.Impressos || b.ImpressosTotal || 0);
    return vendB - vendA;
  });
  
  // Top 5 Maiores Vendas - ROXO do logo (#9b1cdb)
  const top5Maiores = todosPorVendidosMaiores.slice(0, 5);
  document.getElementById('top5MaioresVendas').innerHTML = top5Maiores.map((j, index) => {
    const vendidos = Number(j.Confirmados || j.Impressos || j.ImpressosTotal || 0);
    const livres = Number(j.Livres || j.Livre || j.LivresTotal || 0);
    const reservados = Number(j.Reservados || j.Reservado || 0);
    const total = livres + reservados + vendidos;
    const ocupacao = total > 0 ? ((vendidos / total) * 100).toFixed(1) + '%' : '0%';
    
    const sede = j.Sede || j.Local || 'N/A';
    const grupo = j.Grupo || 'N/A';
    const dataEvento = j.DataEvento || 'Data n√£o dispon√≠vel';
    const rodadaDupla = j.RodadaDupla || j.Rodada || '';
    
    // Extrai os jogos (remove a parte da rodada se tiver)
    const jogosArray = rodadaDupla.split('|').filter(jogo => !jogo.match(/^\d+¬™ Rodada/i));
    const jogosTexto = jogosArray.map(jogo => jogo.trim()).join(' | ') || 'N/A';
    
    return `
      <div style="background:white;padding:12px;border-radius:10px;border-left:5px solid #9b1cdb;box-shadow:0 2px 6px rgba(155,28,219,0.15);">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
          <div style="display:flex;align-items:center;gap:6px;">
            <span style="background:#9b1cdb;color:white;font-weight:900;font-size:11px;padding:3px 8px;border-radius:6px;">#${index + 1}</span>
            <span style="font-size:12px;color:#9b1cdb;font-weight:800;">${formatNumber(vendidos)} vendidos</span>
          </div>
          <span style="background:rgba(155,28,219,0.1);color:#9b1cdb;font-weight:900;font-size:11px;padding:3px 8px;border-radius:6px;">üìä ${ocupacao}</span>
        </div>
        <div style="font-size:11px;color:#334155;font-weight:700;margin-bottom:3px;">‚öΩ ${jogosTexto}</div>
        <div style="font-size:10px;color:#64748b;font-weight:600;margin-bottom:3px;">üìÖ ${dataEvento}</div>
        <div style="font-size:10px;color:#64748b;font-weight:600;">üìç ${sede} ‚Ä¢ üß© ${grupo}</div>
      </div>
    `;
  }).join('');
  
  // Top 5 Menores Vendas - AMARELO do logo (#f8e847)
  const top5Menores = todosPorVendidosMenores.slice(-5).reverse();
  document.getElementById('top5MenoresVendas').innerHTML = top5Menores.map((j, index) => {
    const vendidos = Number(j.Confirmados || j.Impressos || j.ImpressosTotal || 0);
    const livres = Number(j.Livres || j.Livre || j.LivresTotal || 0);
    const reservados = Number(j.Reservados || j.Reservado || 0);
    const total = livres + reservados + vendidos;
    const ocupacao = total > 0 ? ((vendidos / total) * 100).toFixed(1) + '%' : '0%';
    
    const sede = j.Sede || j.Local || 'N/A';
    const grupo = j.Grupo || 'N/A';
    const dataEvento = j.DataEvento || 'Data n√£o dispon√≠vel';
    const rodadaDupla = j.RodadaDupla || j.Rodada || '';
    
    // Extrai os jogos (remove a parte da rodada se tiver)
    const jogosArray = rodadaDupla.split('|').filter(jogo => !jogo.match(/^\d+¬™ Rodada/i));
    const jogosTexto = jogosArray.map(jogo => jogo.trim()).join(' | ') || 'N/A';
    
    return `
      <div style="background:white;padding:12px;border-radius:10px;border-left:5px solid #d97706;box-shadow:0 2px 6px rgba(217,119,6,0.15);">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
          <div style="display:flex;align-items:center;gap:6px;">
            <span style="background:#d97706;color:white;font-weight:900;font-size:11px;padding:3px 8px;border-radius:6px;">#${index + 1}</span>
            <span style="font-size:12px;color:#7a16af;font-weight:800;">${formatNumber(vendidos)} vendidos</span>
          </div>
          <span style="background:rgba(217,119,6,0.1);color:#d97706;font-weight:900;font-size:11px;padding:3px 8px;border-radius:6px;">üìä ${ocupacao}</span>
        </div>
        <div style="font-size:11px;color:#334155;font-weight:700;margin-bottom:3px;">‚öΩ ${jogosTexto}</div>
        <div style="font-size:10px;color:#64748b;font-weight:600;margin-bottom:3px;">üìÖ ${dataEvento}</div>
        <div style="font-size:10px;color:#64748b;font-weight:600;">üìç ${sede} ‚Ä¢ üß© ${grupo}</div>
      </div>
    `;
  }).join('');
}

/* ============================================
   GR√ÅFICO EVOLU√á√ÉO DI√ÅRIA
============================================ */
function renderChartVendasDia(){
  const dados = jsonData.DadosporDia || [];
  const labels = dados.map(x => x.Dia);
  const vendas = dados.map(x => x.VendasDia || 0);
  const usuarios = dados.map(x => x.UsuariosDia || 0);
  const faciais = dados.map(x => x.FaciaisDia || 0);
  
  if(chartVendas) chartVendas.destroy();
  
  chartVendas = new Chart(document.getElementById("chartVendasDia"), {
    type: 'bar',
    data: {
      labels,
      datasets: [
        {
          label: "Vendas",
          data: vendas,
          backgroundColor: 'rgba(155,28,219,0.85)',
          borderColor: 'rgba(155,28,219,1)',
          borderWidth: 2,
          borderRadius: 8,
          borderSkipped: false
        },
        {
          label: "Cadastros",
          data: usuarios,
          backgroundColor: 'rgba(153,51,255,0.75)',
          borderColor: 'rgba(153,51,255,1)',
          borderWidth: 2,
          borderRadius: 8,
          borderSkipped: false
        },
        {
          label: "Faciais",
          data: faciais,
          backgroundColor: 'rgba(255,209,0,0.85)',
          borderColor: 'rgba(255,209,0,1)',
          borderWidth: 2,
          borderRadius: 8,
          borderSkipped: false
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            font: { size: 13, weight: 'bold' },
            color: '#6600cc',
            padding: 15,
            usePointStyle: true,
            pointStyle: 'circle'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(155,28,219,0.95)',
          titleColor: '#fff',
          bodyColor: '#fff',
          padding: 12,
          cornerRadius: 8,
          displayColors: true,
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': ' + formatNumber(context.parsed.y);
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(155,28,219,0.08)', drawBorder: false },
          ticks: { color: '#6600cc', font: { weight: '600' } }
        },
        x: {
          grid: { display: false, drawBorder: false },
          ticks: { color: '#6600cc', font: { weight: '600' } }
        }
      }
    }
  });
}

/* ============================================
   DISTRIBUI√á√ÉO DE INGRESSOS
============================================ */
function renderDistribuicao(mode){
  const d = mode === "total"
    ? jsonData.DistribuicaoTotal?.[0]
    : jsonData.DistribuicaoProximos?.[0];

  const total = d?.TotalIngressosTotal ?? d?.TotalIngressosProximos ?? 0;
  const disp = d?.DisponiveisTotal ?? d?.DisponiveisProximos ?? 0;
  const dispPct = d?.PorcentagemDisponivelTotal ?? d?.PorcentagemDisponivelProximos ?? "";
  const res = d?.ReservadosTotal ?? d?.ReservadosProximos ?? 0;
  const ven = d?.VendidosTotal ?? d?.VendidosProximos ?? 0;
  const ocup = d?.OcupacaoTotal ?? d?.OcupacaoProximos ?? "0%";

  document.getElementById("cardTotalIngressos").textContent = formatNumber(total);
  document.getElementById("cardDisponiveis").textContent = formatNumber(disp);
  document.getElementById("cardDisponiveisPct").textContent = dispPct ? `(${dispPct})` : "";
  document.getElementById("cardReservados").textContent = formatNumber(res);
  document.getElementById("cardVendidos").textContent = formatNumber(ven);
  document.getElementById("ocupacaoValor").textContent = ocup;
}

/* ============================================
   TREEMAP PARA SEDES
============================================ */
/* ============================================
   RENDERIZAR SEDES EM 4 CARDS COM BARRAS
============================================ */
function renderSedesCards(modo = 'total'){
  // Decide qual fonte de dados usar baseado no modo
  let sedes = [];
  let totalGeral = 0;
  
  if(modo === 'proximos'){
    // Usa SedesProximos
    sedes = jsonData.SedesProximos || [];
    totalGeral = sedes.reduce((sum, s) => sum + Number(s.VendidosProximos || 0), 0);
  } else {
    // Usa SedesTotal
    sedes = jsonData.SedesTotal || [];
    totalGeral = sedes.reduce((sum, s) => sum + Number(s.VendidosTotal || 0), 0);
  }
  
  // Atualiza o texto do t√≠tulo
  const modoTextoEl = document.getElementById('sedesModoTexto');
  if(modoTextoEl){
    if(modo === 'proximos'){
      modoTextoEl.textContent = `Pr√≥ximos Jogos: ${formatNumber(totalGeral)}`;
    } else {
      modoTextoEl.textContent = `Total: ${formatNumber(totalGeral)}`;
    }
  }
  
  // Agrupa vendas por sede
  const sedesMap = {};
  sedes.forEach(s => {
    const sede = s.Sede || 'N/A';
    const vendidos = modo === 'proximos' 
      ? Number(s.VendidosProximos || 0) 
      : Number(s.VendidosTotal || 0);
    
    sedesMap[sede] = vendidos;
  });
  
  // Converte para array e ordena por vendidos (maior para menor)
  const sedesArray = Object.entries(sedesMap)
    .map(([sede, vendidos]) => ({ sede, vendidos }))
    .sort((a, b) => b.vendidos - a.vendidos);
  
  // Pega o valor m√°ximo para calcular a porcentagem das barras
  const maxVendidos = sedesArray.length > 0 ? sedesArray[0].vendidos : 1;
  
  // Divide em 4 grupos de 8 sedes cada
  const sedesPorCard = 8;
  const container = document.getElementById('sedesContainer');
  container.innerHTML = '';
  
  for(let cardIndex = 0; cardIndex < 4; cardIndex++){
    const inicio = cardIndex * sedesPorCard;
    const fim = inicio + sedesPorCard;
    const sedesDoCard = sedesArray.slice(inicio, fim);
    
    // Cria o card
    const cardDiv = document.createElement('div');
    cardDiv.className = 'sede-card';
    
    // Adiciona as sedes no card
    sedesDoCard.forEach(({ sede, vendidos }) => {
      const porcentagem = (vendidos / maxVendidos) * 100;
      
      const sedeItem = document.createElement('div');
      sedeItem.className = 'sede-item';
      sedeItem.innerHTML = `
        <div class="sede-nome">${sede}</div>
        <div class="sede-bar-container">
          <div class="sede-bar-bg">
            <div class="sede-bar-fill" style="width:${porcentagem}%"></div>
          </div>
          <div class="sede-valor">${formatNumber(vendidos)}</div>
        </div>
      `;
      cardDiv.appendChild(sedeItem);
    });
    
    // Se n√£o tiver 8 sedes, preenche com vazios
    const faltam = sedesPorCard - sedesDoCard.length;
    for(let i = 0; i < faltam; i++){
      const sedeItem = document.createElement('div');
      sedeItem.className = 'sede-item';
      sedeItem.innerHTML = `
        <div class="sede-nome" style="color:#cbd5e1;">-</div>
        <div class="sede-bar-container">
          <div class="sede-bar-bg">
            <div class="sede-bar-fill" style="width:0%"></div>
          </div>
          <div class="sede-valor" style="color:#cbd5e1;">-</div>
        </div>
      `;
      cardDiv.appendChild(sedeItem);
    }
    
    container.appendChild(cardDiv);
  }
}

/* ============================================
   GR√ÅFICOS DONUT - USU√ÅRIOS E FACIAIS
============================================ */
function renderDonutCharts(){
  const total = jsonData.UsuariosCadastrados?.[0] || {};
  const apos = jsonData.FaciaisAposAberturadosJogos?.[0] || {};
  const dep = jsonData.Dependentes?.[0] || {};

  // ========== CHART 1: BASE TOTAL ==========
  const baseData = {
    usuarios: total.UsuariosTotal || 0,
    coleta: total.ColetaDeFaciais || 0,
    aprovadas: total.FaciaisAprovadasTotal || 0,
    reprovadas: total.FaciaisReprovadasTotal || 0,
    pendentes: total.FaciaisPendenteTotal || 0
  };

  if(chartBaseTotal) chartBaseTotal.destroy();
  
  chartBaseTotal = new Chart(document.getElementById("chartBaseTotal"), {
    type: 'doughnut',
    data: {
      labels: ['Coleta', 'Aprovadas', 'Reprovadas', 'Pendentes'],
      datasets: [{
        data: [baseData.coleta, baseData.aprovadas, baseData.reprovadas, baseData.pendentes],
        backgroundColor: [
          'rgba(155,28,219,0.85)', 
          'rgba(153,51,255,0.85)', 
          'rgba(220,53,69,0.85)', 
          'rgba(255,209,0,0.85)'
        ],
        borderColor: [
          'rgba(155,28,219,1)', 
          'rgba(153,51,255,1)', 
          'rgba(220,53,69,1)', 
          'rgba(255,209,0,1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(155,28,219,0.95)',
          padding: 12,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return context.label + ': ' + formatNumber(context.parsed);
            }
          }
        }
      }
    },
    plugins: [{
      id: 'centerText',
      beforeDraw: function(chart) {
        const ctx = chart.ctx;
        ctx.save();
        const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
        const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#6600cc';
        ctx.font = 'bold 28px Inter, sans-serif';
        ctx.fillText(formatNumber(baseData.usuarios), centerX, centerY - 10);
        ctx.font = 'bold 12px Inter, sans-serif';
        ctx.fillStyle = '#9b1cdb';
        ctx.fillText('USU√ÅRIOS', centerX, centerY + 15);
        ctx.restore();
      }
    }]
  });

  document.getElementById('legendBaseTotal').innerHTML = `
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(155,28,219,0.85)"></span>
        <span class="legend-label">Coleta</span>
      </span>
      <span class="legend-value">${formatNumber(baseData.coleta)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(153,51,255,0.85)"></span>
        <span class="legend-label">Aprovadas</span>
      </span>
      <span class="legend-value">${formatNumber(baseData.aprovadas)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(220,53,69,0.85)"></span>
        <span class="legend-label">Reprovadas</span>
      </span>
      <span class="legend-value">${formatNumber(baseData.reprovadas)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(255,209,0,0.85)"></span>
        <span class="legend-label">Pendentes</span>
      </span>
      <span class="legend-value">${formatNumber(baseData.pendentes)}</span>
    </div>
  `;

  // ========== CHART 2: AP√ìS ABERTURA ==========
  const aposData = {
    usuarios: apos.UsuariosAposAberturaJogo || 0,
    coleta: apos.ColetaDeFaciaisAposAberturaJogo || 0,
    aprovadas: apos.FaciaisAprovadasAposAberturaJogo || 0,
    reprovadas: apos.FaciaisReprovadasAposAberturaJogo || 0,
    pendentes: apos.FaciaisPendenteAposAberturaJogo || 0
  };

  if(chartAposAbertura) chartAposAbertura.destroy();
  
  chartAposAbertura = new Chart(document.getElementById("chartAposAbertura"), {
    type: 'doughnut',
    data: {
      labels: ['Coleta', 'Aprovadas', 'Reprovadas', 'Pendentes'],
      datasets: [{
        data: [aposData.coleta, aposData.aprovadas, aposData.reprovadas, aposData.pendentes],
        backgroundColor: [
          'rgba(155,28,219,0.85)', 
          'rgba(153,51,255,0.85)', 
          'rgba(220,53,69,0.85)', 
          'rgba(255,209,0,0.85)'
        ],
        borderColor: [
          'rgba(155,28,219,1)', 
          'rgba(153,51,255,1)', 
          'rgba(220,53,69,1)', 
          'rgba(255,209,0,1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(155,28,219,0.95)',
          padding: 12,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return context.label + ': ' + formatNumber(context.parsed);
            }
          }
        }
      }
    },
    plugins: [{
      id: 'centerText',
      beforeDraw: function(chart) {
        const ctx = chart.ctx;
        ctx.save();
        const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
        const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#6600cc';
        ctx.font = 'bold 28px Inter, sans-serif';
        ctx.fillText(formatNumber(aposData.usuarios), centerX, centerY - 10);
        ctx.font = 'bold 12px Inter, sans-serif';
        ctx.fillStyle = '#9b1cdb';
        ctx.fillText('USU√ÅRIOS', centerX, centerY + 15);
        ctx.restore();
      }
    }]
  });

  document.getElementById('legendAposAbertura').innerHTML = `
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(155,28,219,0.85)"></span>
        <span class="legend-label">Coleta</span>
      </span>
      <span class="legend-value">${formatNumber(aposData.coleta)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(153,51,255,0.85)"></span>
        <span class="legend-label">Aprovadas</span>
      </span>
      <span class="legend-value">${formatNumber(aposData.aprovadas)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(220,53,69,0.85)"></span>
        <span class="legend-label">Reprovadas</span>
      </span>
      <span class="legend-value">${formatNumber(aposData.reprovadas)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(255,209,0,0.85)"></span>
        <span class="legend-label">Pendentes</span>
      </span>
      <span class="legend-value">${formatNumber(aposData.pendentes)}</span>
    </div>
  `;

  // ========== CHART 3: DEPENDENTES ==========
  const depData = {
    cadastrados: dep.DependentesCadastrados || 0,
    aprovados: dep.SolicitacoesAprovadas || 0,
    reprovados: dep.SolicitacoesReprovadas || 0,
    pendentes: dep.AguardandoAceite || 0
  };

  if(chartDependentes) chartDependentes.destroy();
  
  chartDependentes = new Chart(document.getElementById("chartDependentes"), {
    type: 'doughnut',
    data: {
      labels: ['Aprovados', 'Reprovados', 'Pendentes'],
      datasets: [{
        data: [depData.aprovados, depData.reprovados, depData.pendentes],
        backgroundColor: [
          'rgba(153,51,255,0.85)', 
          'rgba(220,53,69,0.85)', 
          'rgba(255,209,0,0.85)'
        ],
        borderColor: [
          'rgba(153,51,255,1)', 
          'rgba(220,53,69,1)', 
          'rgba(255,209,0,1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(155,28,219,0.95)',
          padding: 12,
          cornerRadius: 8,
          callbacks: {
            label: function(context) {
              return context.label + ': ' + formatNumber(context.parsed);
            }
          }
        }
      }
    },
    plugins: [{
      id: 'centerText',
      beforeDraw: function(chart) {
        const ctx = chart.ctx;
        ctx.save();
        const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
        const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#6600cc';
        ctx.font = 'bold 28px Inter, sans-serif';
        ctx.fillText(formatNumber(depData.cadastrados), centerX, centerY - 10);
        ctx.font = 'bold 11px Inter, sans-serif';
        ctx.fillStyle = '#9b1cdb';
        ctx.fillText('CADASTRADOS', centerX, centerY + 15);
        ctx.restore();
      }
    }]
  });

  document.getElementById('legendDependentes').innerHTML = `
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(153,51,255,0.85)"></span>
        <span class="legend-label">Aprovados</span>
      </span>
      <span class="legend-value">${formatNumber(depData.aprovados)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(220,53,69,0.85)"></span>
        <span class="legend-label">Reprovados</span>
      </span>
      <span class="legend-value">${formatNumber(depData.reprovados)}</span>
    </div>
    <div class="legend-item">
      <span>
        <span class="legend-color" style="background:rgba(255,209,0,0.85)"></span>
        <span class="legend-label">Pendentes</span>
      </span>
      <span class="legend-value">${formatNumber(depData.pendentes)}</span>
    </div>
  `;
}

/* ============================================
   TABELA DE JOGOS COM FILTRO DE RODADAS E ORDENA√á√ÉO
============================================ */
function renderTabelaJogos(rodadaFiltrada = "todas", aplicarOrdenacao = true){
  const tbody = document.querySelector("#tabelaJogos tbody");
  if(!tbody) { 
    return; 
  }
  
  tbody.innerHTML = "";
  
  // Se rodadaFiltrada for null, mostra mensagem inicial
  if(rodadaFiltrada === null){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td colspan="11" style="padding:40px 20px;text-align:center;">
        <div style="font-size:48px;margin-bottom:12px;">‚öΩ</div>
        <div style="font-size:16px;font-weight:700;color:var(--purple-dark);margin-bottom:8px;">Selecione uma rodada para visualizar</div>
        <div style="font-size:13px;color:#64748b;">üëÜ Use os filtros acima para exibir os jogos</div>
      </td>
    `;
    tbody.appendChild(tr);
    return;
  }

  let dados = (jsonData && jsonData.Jogos) ? [...jsonData.Jogos] : [];
  
  // Salva dados originais se ainda n√£o tiver
  if(dadosOriginais.length === 0 && dados.length > 0){
    dadosOriginais = [...dados];
  }
  
  // Aplica filtro de rodada
  if(rodadaFiltrada !== "todas"){
    dados = dados.filter(j => {
      const rodada = j.Rodada ?? j.rodada ?? '';
      return String(rodada) === String(rodadaFiltrada);
    });
  }
  
  // Aplica ordena√ß√£o se houver coluna selecionada
  if(aplicarOrdenacao && sortColumn){
    dados.sort((a, b) => {
      let valA, valB;
      
      switch(sortColumn){
        case 'sede':
          valA = (a.Sede || a.Local || '').toLowerCase();
          valB = (b.Sede || b.Local || '').toLowerCase();
          break;
        case 'grupo':
          valA = (a.Grupo || '').toLowerCase();
          valB = (b.Grupo || '').toLowerCase();
          break;
        case 'data':
          valA = a.DataEvento || '';
          valB = b.DataEvento || '';
          break;
        case 'livre':
          valA = Number(a.Livres || a.Livre || a.LivresTotal || 0);
          valB = Number(b.Livres || b.Livre || b.LivresTotal || 0);
          break;
        case 'reservado':
          valA = Number(a.Reservados || a.Reservado || 0);
          valB = Number(b.Reservados || b.Reservado || 0);
          break;
        case 'confirmado':
          valA = Number(a.Confirmados || a.Impressos || a.ImpressosTotal || 0);
          valB = Number(b.Confirmados || b.Impressos || b.ImpressosTotal || 0);
          break;
        case 'acessos':
          valA = Number(a.Acessos || 0);
          valB = Number(b.Acessos || 0);
          break;
        case 'ocupacao':
          const livresA = Number(a.Livres || a.Livre || a.LivresTotal || 0);
          const reservadosA = Number(a.Reservados || a.Reservado || 0);
          const confirmadosA = Number(a.Confirmados || a.Impressos || a.ImpressosTotal || 0);
          const totalA = livresA + reservadosA + confirmadosA;
          valA = totalA > 0 ? (confirmadosA / totalA) * 100 : 0;
          
          const livresB = Number(b.Livres || b.Livre || b.LivresTotal || 0);
          const reservadosB = Number(b.Reservados || b.Reservado || 0);
          const confirmadosB = Number(b.Confirmados || b.Impressos || b.ImpressosTotal || 0);
          const totalB = livresB + reservadosB + confirmadosB;
          valB = totalB > 0 ? (confirmadosB / totalB) * 100 : 0;
          break;
        case 'status':
          valA = (a.StatusEvento || '').toLowerCase();
          valB = (b.StatusEvento || '').toLowerCase();
          break;
        default:
          return 0;
      }
      
      // Compara√ß√£o
      let comparison = 0;
      if(typeof valA === 'string'){
        comparison = valA.localeCompare(valB);
      } else {
        comparison = valA - valB;
      }
      
      return sortDirection === 'asc' ? comparison : -comparison;
    });
  }
  
  if(!Array.isArray(dados) || dados.length === 0){
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="11" style="padding:30px;color:#666;text-align:center;font-size:14px;">üì≠ Nenhum jogo encontrado para esta rodada.</td>`;
    tbody.appendChild(tr);
    return;
  }

  dados.forEach(j => {
    const codigo = j.CodigoEVE ?? j.codigoEVE ?? '';
    const sede = j.Sede ?? j.Local ?? '';
    const grupo = j.Grupo ?? '';
    const rodada = j.RodadaDupla ?? j.Rodada ?? '';
    const dataEvento = j.DataEvento ?? '';
    const statusEvento = j.StatusEvento ?? 'Desconhecido';
    
    // Separar data e hora
    let dataFormatada = dataEvento;
    let horaFormatada = '';
    if(dataEvento && dataEvento.includes(' ')){
      const partes = dataEvento.split(' ');
      dataFormatada = partes[0]; // Primeira parte: data
      horaFormatada = partes.slice(1).join(' '); // Resto: hora
    }
    
    const livres = Number(j.Livres ?? j.Livre ?? j.LivresTotal ?? 0);
    const reservados = Number(j.Reservados ?? j.Reservado ?? 0);
    const confirmados = Number(j.Confirmados ?? j.Impressos ?? j.Impresso ?? j.ImpressosTotal ?? 0);
    const acessos = Number(j.Acessos ?? 0);
    
    let ocupacao = j.OcupacaoTotal ?? j.Ocupacao ?? '';
    if(!ocupacao){
      const total = livres + reservados + confirmados;
      ocupacao = total > 0 ? ((confirmados / total) * 100).toFixed(2) + '%' : '0.00%';
    }
    
    const statusClass = statusEvento.toLowerCase().includes('encerrado') ? 'status-encerrado' : 'status-aberto';
    
    const jogos = rodada.split('|').map(jogo => 
      `<div class="game-item">‚öΩ ${jogo.trim()}</div>`
    ).join('');

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="codigo-cell">${escapeHtml(codigo)}</td>
      <td class="sede-cell"><span>üìç</span>${escapeHtml(sede)}</td>
      <td class="grupo-cell">${escapeHtml(grupo)}</td>
      <td class="games">${jogos}</td>
      <td class="data-cell">
        <span class="date">${escapeHtml(dataFormatada)}</span>
        ${horaFormatada ? `<span class="time">‚è∞ ${escapeHtml(horaFormatada)}</span>` : ''}
      </td>
      <td><span class="number-cell number-green">${formatNumber(livres)}</span></td>
      <td><span class="number-cell number-purple">${formatNumber(reservados)}</span></td>
      <td><span class="number-cell number-blue">${formatNumber(confirmados)}</span></td>
      <td><span class="number-cell number-orange">${formatNumber(acessos)}</span></td>
      <td><span class="ocupacao-cell">${ocupacao}</span></td>
      <td><span class="status-badge ${statusClass}">${escapeHtml(statusEvento)}</span></td>
    `;
    tbody.appendChild(tr);
  });
}

/* ============================================
   EXPORTAR DASHBOARD PARA PDF
============================================ */
async function exportarDashboard(){
  const btnExport = document.getElementById("btnExport");
  const loadTimestamp = document.getElementById("loadTimestamp");
  let logo = null;
  let logoDisplay = null;
  
  try {
    btnExport.disabled = true;
    btnExport.textContent = "‚è≥ Gerando PDF...";
    
    window.scrollTo(0, 0);
    
    // Esconde logo temporariamente para evitar CORS
    logo = document.querySelector('.header-left img');
    if(logo) {
      logoDisplay = logo.style.display;
      logo.style.display = 'none';
    }
    
    await new Promise(resolve => setTimeout(resolve, 500));
    
    const container = document.querySelector('.container');
    
    const canvas = await html2canvas(container, {
      scale: 2,
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#f6f5fb',
      logging: false,
      width: container.scrollWidth,
      height: container.scrollHeight,
      scrollY: -window.scrollY,
      scrollX: -window.scrollX
    });
    
    const imgData = canvas.toDataURL('image/png', 1.0);
    const { jsPDF } = window.jspdf;
    
    const pdf = new jsPDF({
      orientation: 'landscape',
      unit: 'mm',
      format: 'a4'
    });
    
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    
    const imgWidth = pdfWidth;
    const imgHeight = (canvas.height * pdfWidth) / canvas.width;
    
    let heightLeft = imgHeight;
    let position = 0;
    
    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, '', 'FAST');
    heightLeft -= pdfHeight;
    
    while (heightLeft >= 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, '', 'FAST');
      heightLeft -= pdfHeight;
    }
    
    const now = new Date();
    const filename = `Dashboard_Copinha_Masculina_2026_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}h${String(now.getMinutes()).padStart(2,'0')}.pdf`;
    
    pdf.save(filename);
    
    // Restaura logo
    if(logo) {
      logo.style.display = logoDisplay || '';
    }
    
    const originalText = loadTimestamp.textContent;
    const originalBg = loadTimestamp.style.background;
    const originalColor = loadTimestamp.style.color;
    
    loadTimestamp.textContent = "‚úÖ PDF exportado com sucesso!";
    loadTimestamp.style.background = "rgba(76,175,80,0.2)";
    loadTimestamp.style.color = "#2e7d32";
    
    setTimeout(() => {
      loadTimestamp.textContent = originalText;
      loadTimestamp.style.background = originalBg;
      loadTimestamp.style.color = originalColor;
    }, 3000);
    
  } catch (error) {
    console.error('Erro ao exportar PDF:', error);
    alert("‚ùå Erro ao exportar PDF: " + error.message + "\n\nVerifique o console para mais detalhes.");
  } finally {
    // Garante que logo seja restaurada
    if(logo && logo.style.display === 'none') {
      logo.style.display = logoDisplay || '';
    }
    btnExport.disabled = false;
    btnExport.textContent = "üìÑ Exportar PDF";
  }
}

/* ============================================
   EVENT LISTENERS
============================================ */
// Bot√£o Atualizar
document.getElementById("btnRefresh").addEventListener("click", carregarDadosAPI);

// Bot√£o Exportar PDF
document.getElementById("btnExport").addEventListener("click", exportarDashboard);

// Bot√µes Modo Geral / Sede
document.getElementById("btnModoGeral").addEventListener("click", function(){
  modoAtual = 'geral';
  sedeAtual = null;
  
  // Atualiza visual dos bot√µes
  document.getElementById("btnModoGeral").classList.add("active");
  document.getElementById("btnModoSede").classList.remove("active");
  
  // Recarrega dados
  carregarDadosAPI();
});

document.getElementById("btnModoSede").addEventListener("click", function(){
  // Pede o nome da sede
  const sede = prompt("Digite o nome da sede (ex: assis, jau, aracatuba):");
  
  if(!sede || sede.trim() === ''){
    alert("Nome da sede n√£o pode estar vazio!");
    return;
  }
  
  modoAtual = 'sede';
  sedeAtual = sede.trim().toLowerCase();
  
  // Atualiza visual dos bot√µes
  document.getElementById("btnModoSede").classList.add("active");
  document.getElementById("btnModoGeral").classList.remove("active");
  
  // Recarrega dados
  carregarDadosAPI();
});

// Bot√µes Total / Pr√≥ximos Jogos
document.getElementById("btnTotal").addEventListener("click", function(){
  distribMode = "total";
  renderDistribuicao("total");
  renderSedesCards("total"); // Atualiza tamb√©m o card de Sedes
  document.getElementById("btnTotal").classList.add("active");
  document.getElementById("btnProximos").classList.remove("active");
});

document.getElementById("btnProximos").addEventListener("click", function(){
  distribMode = "proximos";
  renderDistribuicao("proximos");
  renderSedesCards("proximos"); // Atualiza tamb√©m o card de Sedes
  document.getElementById("btnProximos").classList.add("active");
  document.getElementById("btnTotal").classList.remove("active");
});

// Bot√µes Toggle de Filtro - Top 5 Maiores e Menores
document.getElementById("toggleMaiores").addEventListener("click", function(){
  filtroMaioresAbertos = !filtroMaioresAbertos;
  this.classList.toggle("active", filtroMaioresAbertos);
  renderTop5Insights();
});

document.getElementById("toggleMenores").addEventListener("click", function(){
  filtroMenoresAbertos = !filtroMenoresAbertos;
  this.classList.toggle("active", filtroMenoresAbertos);
  renderTop5Insights();
});

// Bot√µes de Filtro de Rodadas
document.querySelectorAll('.rodada-btn').forEach(btn => {
  btn.addEventListener('click', function(){
    // Remove active de todos
    document.querySelectorAll('.rodada-btn').forEach(b => b.classList.remove('active'));
    
    // Adiciona active no clicado
    this.classList.add('active');
    
    // Pega a rodada do data-attribute
    const rodada = this.getAttribute('data-rodada');
    rodadaFiltro = rodada;
    
    // Reset da ordena√ß√£o ao trocar de rodada
    sortColumn = null;
    sortDirection = 'asc';
    document.querySelectorAll('th.sortable').forEach(th => {
      th.classList.remove('asc', 'desc');
    });
    
    // Renderiza a tabela com o filtro
    renderTabelaJogos(rodada, false);
  });
});

// Event listeners para ordena√ß√£o da tabela
document.querySelectorAll('th.sortable').forEach(th => {
  th.addEventListener('click', function(){
    const column = this.getAttribute('data-column');
    
    // Se clicou na mesma coluna, inverte a dire√ß√£o
    if(sortColumn === column){
      sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
    } else {
      // Nova coluna, come√ßa com ascendente
      sortColumn = column;
      sortDirection = 'asc';
    }
    
    // Remove classes de todas as colunas
    document.querySelectorAll('th.sortable').forEach(header => {
      header.classList.remove('asc', 'desc');
    });
    
    // Adiciona classe na coluna atual
    this.classList.add(sortDirection);
    
    // Re-renderiza a tabela com ordena√ß√£o
    renderTabelaJogos(rodadaFiltro, true);
  });
});

/* ============================================
   INICIALIZA√á√ÉO AUTOM√ÅTICA
============================================ */
window.addEventListener("DOMContentLoaded", function(){
  // Detecta automaticamente a sede pela URL
  detectarSedeAutomaticamente();
  
  // Inicia o progress bar em 5%
  setProgress(5);
  
  // Carrega dados da API automaticamente
  carregarDadosAPI();
  
  // Auto-refresh a cada 5 minutos (300000ms)
  // Descomente a linha abaixo se quiser ativar o auto-refresh
  // setInterval(carregarDadosAPI, 300000);
});

// Detecta mudan√ßa de hash (#) sem precisar recarregar
window.addEventListener("hashchange", function(){
  detectarSedeAutomaticamente();
  carregarDadosAPI();
});

/* ============================================
   DETEC√á√ÉO AUTOM√ÅTICA DE SEDE PELA URL
============================================ */
function detectarSedeAutomaticamente(){
  let sede = null;
  
  // Op√ß√£o 1: Detecta por HASH (#) - para testes locais
  // Exemplo: file:///dashboard.html#assis
  const hash = window.location.hash.replace('#', '').trim();
  if(hash){
    sede = hash;
  }
  
  // Op√ß√£o 2: Detecta por PATH (/) - para produ√ß√£o
  // Exemplo: https://dashboard.soudaliga.com.br/assis
  if(!sede){
    const path = window.location.pathname;
    const pathParts = path.split('/').filter(p => p.length > 0);
    
    // Se tiver alguma parte no path (ex: /assis), usa como sede
    if(pathParts.length > 0){
      // Pega a √∫ltima parte do path
      sede = pathParts[pathParts.length - 1];
      
      // Ignora se for index.html ou dashboard.html
      if(sede === 'index.html' || sede === 'dashboard.html'){
        sede = null;
      } else {
      }
    }
  }
  
  // Se detectou uma sede, configura o modo
  if(sede){
    modoAtual = 'sede';
    sedeAtual = sede.toLowerCase();
    
    // Atualiza visual dos bot√µes
    document.getElementById("btnModoSede").classList.add("active");
    document.getElementById("btnModoGeral").classList.remove("active");
    
    // Esconde os bot√µes em produ√ß√£o (quando detecta automaticamente)
    document.getElementById("btnModoSede").style.display = 'none';
    document.getElementById("btnModoGeral").style.display = 'none';
    
  } else {
    // Modo geral (padr√£o)
    modoAtual = 'geral';
    sedeAtual = null;
    
    // Limpa o texto da sede no header
    const sedeHeaderEl = document.getElementById("sedeHeaderTexto");
    if(sedeHeaderEl){
      sedeHeaderEl.innerHTML = '';
    }
    
    // Verifica se est√° em produ√ß√£o (URL n√£o √© localhost nem file://)
    const isProducao = window.location.hostname === 'dashboard.soudaliga.com.br';
    
    if(isProducao){
      // Esconde os bot√µes em produ√ß√£o quando for modo geral
      document.getElementById("btnModoSede").style.display = 'none';
      document.getElementById("btnModoGeral").style.display = 'none';
    }
    
  }
}

</script>
</body>
</html>
